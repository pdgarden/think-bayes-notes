<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Think Bayes - Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="think_bayes_notes_files/libs/clipboard/clipboard.min.js"></script>
<script src="think_bayes_notes_files/libs/quarto-html/quarto.js"></script>
<script src="think_bayes_notes_files/libs/quarto-html/popper.min.js"></script>
<script src="think_bayes_notes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="think_bayes_notes_files/libs/quarto-html/anchor.min.js"></script>
<link href="think_bayes_notes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="think_bayes_notes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="think_bayes_notes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="think_bayes_notes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="think_bayes_notes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#bayess-theorem" id="toc-bayess-theorem" class="nav-link active" data-scroll-target="#bayess-theorem"><span class="header-section-number">1</span> Bayes’s theorem</a></li>
  <li><a href="#pmf-cdf" id="toc-pmf-cdf" class="nav-link" data-scroll-target="#pmf-cdf"><span class="header-section-number">2</span> Pmf / Cdf</a>
  <ul>
  <li><a href="#creation-and-usage" id="toc-creation-and-usage" class="nav-link" data-scroll-target="#creation-and-usage"><span class="header-section-number">2.1</span> Creation and usage</a></li>
  <li><a href="#mixture" id="toc-mixture" class="nav-link" data-scroll-target="#mixture"><span class="header-section-number">2.2</span> Mixture</a></li>
  <li><a href="#utils-pmf" id="toc-utils-pmf" class="nav-link" data-scroll-target="#utils-pmf"><span class="header-section-number">2.3</span> Utils Pmf</a></li>
  </ul></li>
  <li><a href="#grid-method" id="toc-grid-method" class="nav-link" data-scroll-target="#grid-method"><span class="header-section-number">3</span> Grid method</a>
  <ul>
  <li><a href="#parameter-grid" id="toc-parameter-grid" class="nav-link" data-scroll-target="#parameter-grid"><span class="header-section-number">3.1</span> 1-parameter grid</a></li>
  <li><a href="#parameters-grid" id="toc-parameters-grid" class="nav-link" data-scroll-target="#parameters-grid"><span class="header-section-number">3.2</span> 2-parameters grid</a></li>
  </ul></li>
  <li><a href="#probability-laws" id="toc-probability-laws" class="nav-link" data-scroll-target="#probability-laws"><span class="header-section-number">4</span> Probability laws</a>
  <ul>
  <li><a href="#binomial" id="toc-binomial" class="nav-link" data-scroll-target="#binomial"><span class="header-section-number">4.1</span> Binomial</a>
  <ul>
  <li><a href="#estimating-proportion-p" id="toc-estimating-proportion-p" class="nav-link" data-scroll-target="#estimating-proportion-p"><span class="header-section-number">4.1.1</span> Estimating proportion p</a>
  <ul class="collapse">
  <li><a href="#grid-method-1" id="toc-grid-method-1" class="nav-link" data-scroll-target="#grid-method-1"><span class="header-section-number">4.1.1.1</span> Grid Method</a></li>
  <li><a href="#conjugate-priors" id="toc-conjugate-priors" class="nav-link" data-scroll-target="#conjugate-priors"><span class="header-section-number">4.1.1.2</span> Conjugate priors</a></li>
  <li><a href="#mcmc" id="toc-mcmc" class="nav-link" data-scroll-target="#mcmc"><span class="header-section-number">4.1.1.3</span> MCMC</a></li>
  </ul></li>
  <li><a href="#estimating-count" id="toc-estimating-count" class="nav-link" data-scroll-target="#estimating-count"><span class="header-section-number">4.1.2</span> Estimating count</a></li>
  </ul></li>
  <li><a href="#multinomial" id="toc-multinomial" class="nav-link" data-scroll-target="#multinomial"><span class="header-section-number">4.2</span> Multinomial</a></li>
  <li><a href="#poisson" id="toc-poisson" class="nav-link" data-scroll-target="#poisson"><span class="header-section-number">4.3</span> Poisson</a>
  <ul>
  <li><a href="#grid-method-2" id="toc-grid-method-2" class="nav-link" data-scroll-target="#grid-method-2"><span class="header-section-number">4.3.1</span> Grid method</a></li>
  <li><a href="#conjugate-priors-1" id="toc-conjugate-priors-1" class="nav-link" data-scroll-target="#conjugate-priors-1"><span class="header-section-number">4.3.2</span> Conjugate priors</a></li>
  <li><a href="#mcmc-1" id="toc-mcmc-1" class="nav-link" data-scroll-target="#mcmc-1"><span class="header-section-number">4.3.3</span> MCMC</a></li>
  </ul></li>
  <li><a href="#exponential" id="toc-exponential" class="nav-link" data-scroll-target="#exponential"><span class="header-section-number">4.4</span> Exponential</a>
  <ul>
  <li><a href="#grid-method-3" id="toc-grid-method-3" class="nav-link" data-scroll-target="#grid-method-3"><span class="header-section-number">4.4.1</span> Grid method</a></li>
  </ul></li>
  <li><a href="#normal" id="toc-normal" class="nav-link" data-scroll-target="#normal"><span class="header-section-number">4.5</span> Normal</a>
  <ul>
  <li><a href="#grid-method-4" id="toc-grid-method-4" class="nav-link" data-scroll-target="#grid-method-4"><span class="header-section-number">4.5.1</span> Grid method</a></li>
  <li><a href="#mcmc-2" id="toc-mcmc-2" class="nav-link" data-scroll-target="#mcmc-2"><span class="header-section-number">4.5.2</span> MCMC</a></li>
  </ul></li>
  <li><a href="#weibull" id="toc-weibull" class="nav-link" data-scroll-target="#weibull"><span class="header-section-number">4.6</span> Weibull</a>
  <ul>
  <li><a href="#parameters-influence" id="toc-parameters-influence" class="nav-link" data-scroll-target="#parameters-influence"><span class="header-section-number">4.6.1</span> Parameters’ influence</a></li>
  <li><a href="#grid-method-5" id="toc-grid-method-5" class="nav-link" data-scroll-target="#grid-method-5"><span class="header-section-number">4.6.2</span> Grid method</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression"><span class="header-section-number">5</span> Regression</a>
  <ul>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">5.1</span> Logistic regression</a>
  <ul>
  <li><a href="#grid-method-6" id="toc-grid-method-6" class="nav-link" data-scroll-target="#grid-method-6"><span class="header-section-number">5.1.1</span> Grid method</a></li>
  <li><a href="#mcmc---pymc" id="toc-mcmc---pymc" class="nav-link" data-scroll-target="#mcmc---pymc"><span class="header-section-number">5.1.2</span> MCMC - PyMC</a></li>
  <li><a href="#mcmc---bambi" id="toc-mcmc---bambi" class="nav-link" data-scroll-target="#mcmc---bambi"><span class="header-section-number">5.1.3</span> MCMC - Bambi</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation"><span class="header-section-number">5.1.4</span> Interpretation</a>
  <ul class="collapse">
  <li><a href="#interpretation-of-intercept" id="toc-interpretation-of-intercept" class="nav-link" data-scroll-target="#interpretation-of-intercept"><span class="header-section-number">5.1.4.1</span> Interpretation of intercept</a></li>
  <li><a href="#interpretation-of-slope" id="toc-interpretation-of-slope" class="nav-link" data-scroll-target="#interpretation-of-slope"><span class="header-section-number">5.1.4.2</span> Interpretation of slope</a></li>
  <li><a href="#uncertainty-on-logistic-curve" id="toc-uncertainty-on-logistic-curve" class="nav-link" data-scroll-target="#uncertainty-on-logistic-curve"><span class="header-section-number">5.1.4.3</span> Uncertainty on logistic curve</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression"><span class="header-section-number">5.2</span> Linear regression</a>
  <ul>
  <li><a href="#grid-method-7" id="toc-grid-method-7" class="nav-link" data-scroll-target="#grid-method-7"><span class="header-section-number">5.2.1</span> Grid method</a></li>
  <li><a href="#mcmc---pymc-1" id="toc-mcmc---pymc-1" class="nav-link" data-scroll-target="#mcmc---pymc-1"><span class="header-section-number">5.2.2</span> MCMC - PyMC</a></li>
  <li><a href="#mcmc---bambi-1" id="toc-mcmc---bambi-1" class="nav-link" data-scroll-target="#mcmc---bambi-1"><span class="header-section-number">5.2.3</span> MCMC - Bambi</a></li>
  <li><a href="#uncertainty-on-regression-curve" id="toc-uncertainty-on-regression-curve" class="nav-link" data-scroll-target="#uncertainty-on-regression-curve"><span class="header-section-number">5.2.4</span> Uncertainty on regression curve</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Think Bayes - Notes</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Notes related to the book <a href="https://allendowney.github.io/ThinkBayes2/">Think Bayes v2</a> which introduces Bayesian statistics using computational methods</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:08.130559Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:08.130449Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.421345Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.420908Z&quot;}" data-execution_count="1">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># import dependencies</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">import</span> scipy</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">from</span> empiricaldist <span class="im">import</span> Pmf, Cdf</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="im">import</span> bambi <span class="im">as</span> bmb</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="im">import</span> arviz <span class="im">as</span> az</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.424735Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.424447Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.427846Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.427111Z&quot;}" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="bayess-theorem" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="bayess-theorem"><span class="header-section-number">1</span> Bayes’s theorem</h2>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given</p>
<p><span class="math display">\[ P(A|B) = \frac{P(A \cap B)}{P(B)} \]</span></p>
<p>and</p>
<p><span class="math display">\[ P(A \cap B) = P(B \cap A) \]</span></p>
<p>We can prove the Bayes’s Theorem:</p>
<p><span class="math display">\[ P(A|B) = \frac{P(A) * P(B|A)}{P(B)} \]</span></p>
<p>Which can be written as</p>
<p><span class="math display">\[ P(H|Obs) = \frac{P(H) * P(Obs|H)}{P(Obs)} \]</span></p>
<p>Where:</p>
<p><span class="math display">\[\begin{align}
    P(H|Obs)) &amp; : \text{Posterior} \\
    P(H) &amp; : \text{Prior} \\
    P(Obs|H)   &amp; : \text{Likelihood } A \\
    P(Obs)   &amp; : \text{Total probability of observation}\\
\end{align}\]</span></p>
<hr>
<p>Usually, to compute the posterior with the grid method, we specify the prior in order it includes all possible values of Obs with null intersection:</p>
<p><span class="math display">\[ P(Obs) = \sum_{i=1}^n P(H) * P(Obs_i | H) \]</span></p>
</div>
</div>
</section>
<section id="pmf-cdf" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="pmf-cdf"><span class="header-section-number">2</span> Pmf / Cdf</h2>
<p>The followings are class implemented in the empiricaldist library which extands pd.Series class.</p>
<ul>
<li><strong>Pmf:</strong> Probablity mass function<br>
</li>
<li><strong>Cdf:</strong> Cumulative density function</li>
</ul>
<section id="creation-and-usage" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="creation-and-usage"><span class="header-section-number">2.1</span> Creation and usage</h3>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.430000Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.429821Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.436030Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.435680Z&quot;}" data-execution_count="3">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># ----------</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># Create Pmf</span></span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># from sequence</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>pmf <span class="op">=</span> Pmf.from_seq([<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># specify range</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>range_qs <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">101</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a>ps <span class="op">=</span> scipy.stats.norm(<span class="dv">5</span>, <span class="dv">1</span>).pdf(range_qs)  <span class="co"># normal distribution</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>pmf <span class="op">=</span> Pmf(ps, range_qs)</span>
<span id="cb3-11"><a href="#cb3-11"></a>pmf.normalize()</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># ------------------</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co"># Specific functions</span></span>
<span id="cb3-15"><a href="#cb3-15"></a></span>
<span id="cb3-16"><a href="#cb3-16"></a>pmf.mean()</span>
<span id="cb3-17"><a href="#cb3-17"></a>pmf.credible_interval(<span class="fl">0.9</span>)</span>
<span id="cb3-18"><a href="#cb3-18"></a>pmf.make_cdf()</span>
<span id="cb3-19"><a href="#cb3-19"></a>pmf.idxmax()</span>
<span id="cb3-20"><a href="#cb3-20"></a>pmf.max_prob()</span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co"># ----------</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co"># Create Cdf</span></span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co"># from pmf</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>cdf <span class="op">=</span> pmf.make_cdf()</span>
<span id="cb3-28"><a href="#cb3-28"></a>pmf <span class="op">=</span> cdf.make_pmf()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mixture" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="mixture"><span class="header-section-number">2.2</span> Mixture</h3>
<p><strong>TODO</strong>: Add corresponding matrix operations</p>
<p>We can compute a distribution as mixture of other distributions</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.465876Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.465427Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.469003Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.468710Z&quot;}" data-execution_count="4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">def</span> make_mixture(pmf: Pmf, pmf_seq: <span class="bu">list</span>[pmf]) <span class="op">-&gt;</span> Pmf:</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">    Make a mixture of distributions</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">    </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">    pmf: map each hypothesis to a probability</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">    pmf_seq: sequence pmf, for each hypothesis</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">    """</span></span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>    df <span class="op">=</span> pd.DataFrame(pmf_seq).fillna(<span class="dv">0</span>).transpose()</span>
<span id="cb4-10"><a href="#cb4-10"></a>    df <span class="op">*=</span> np.array(pmf)</span>
<span id="cb4-11"><a href="#cb4-11"></a>    total <span class="op">=</span> df.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>    <span class="cf">return</span> Pmf(total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We choose a dice at random on a bag and roll it 1 time, we don’t know the nb of sides, but we know the corresponding probability (e.g.&nbsp;the number of dices on the bag): <span class="math display">\[\begin{align}
    P(nb\_sides=4) = 1 / 6  \\
    P(nb\_sides=6) = 2 / 6 \\
    P(nb\_sides=8) = 3 / 6 \\
\end{align}\]</span></p>
<p>Given this uncertainty, we can compute the Pmf of the outcome</p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.470562Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.470452Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.479545Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.479301Z&quot;}" data-execution_count="5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>pmf_dice <span class="op">=</span> Pmf([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>])</span>
<span id="cb5-2"><a href="#cb5-2"></a>pmf_dice.normalize()</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>dice_4 <span class="op">=</span> Pmf(<span class="dv">1</span> <span class="op">/</span> <span class="dv">4</span>, <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">4</span> <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb5-5"><a href="#cb5-5"></a>dice_6 <span class="op">=</span> Pmf(<span class="dv">1</span> <span class="op">/</span> <span class="dv">6</span>, <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span> <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb5-6"><a href="#cb5-6"></a>dice_8 <span class="op">=</span> Pmf(<span class="dv">1</span> <span class="op">/</span> <span class="dv">8</span>, <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">8</span> <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>make_mixture(pmf<span class="op">=</span>pmf_dice, pmf_seq<span class="op">=</span>[dice_4,dice_6,dice_8])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<caption>Pmf of distributions mixture </caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">probs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0.159722</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.159722</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.159722</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0.159722</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>0.118056</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>0.118056</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>0.062500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>0.062500</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="utils-pmf" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="utils-pmf"><span class="header-section-number">2.3</span> Utils Pmf</h3>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.481036Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.480926Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.484225Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.483976Z&quot;}" data-execution_count="6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">def</span> pmf_from_dist(dist, qs: np.array) <span class="op">-&gt;</span> Pmf:</span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="co">"""</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">    Make a discrete approximation of a scipy distribution.</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">    dist: SciPy distribution object</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">    qs: quantities</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">    """</span></span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a>    ps <span class="op">=</span> dist.pdf(qs)</span>
<span id="cb6-9"><a href="#cb6-9"></a>    pmf <span class="op">=</span> Pmf(ps, qs)</span>
<span id="cb6-10"><a href="#cb6-10"></a>    pmf.normalize()</span>
<span id="cb6-11"><a href="#cb6-11"></a></span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="cf">return</span> pmf</span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="kw">def</span> pmf_kde_from_sample(sample: np.array, qs: np.array, <span class="op">**</span>options) <span class="op">-&gt;</span> Pmf:</span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="co">"""</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">    Make a kernel density estimate from a sample</span></span>
<span id="cb6-18"><a href="#cb6-18"></a></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">    sample: sequence of values</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">    qs: quantities where we should evaluate the KDE</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">    """</span></span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a>    kde <span class="op">=</span> scipy.stats.gaussian_kde(sample)</span>
<span id="cb6-24"><a href="#cb6-24"></a>    ps <span class="op">=</span> kde(qs)</span>
<span id="cb6-25"><a href="#cb6-25"></a>    pmf <span class="op">=</span> Pmf(ps, qs, <span class="op">**</span>options)</span>
<span id="cb6-26"><a href="#cb6-26"></a>    pmf.normalize()</span>
<span id="cb6-27"><a href="#cb6-27"></a></span>
<span id="cb6-28"><a href="#cb6-28"></a>    <span class="cf">return</span> pmf</span>
<span id="cb6-29"><a href="#cb6-29"></a></span>
<span id="cb6-30"><a href="#cb6-30"></a></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="kw">def</span> kde_from_pmf(pmf: Pmf, n: <span class="bu">int</span> <span class="op">=</span> <span class="dv">101</span>, qs: Optional[np.array] <span class="op">=</span> <span class="va">None</span>, <span class="op">**</span>options) <span class="op">-&gt;</span> Pmf:</span>
<span id="cb6-32"><a href="#cb6-32"></a>    <span class="co">"""</span></span>
<span id="cb6-33"><a href="#cb6-33"></a><span class="co">    Make a kernel density estimate from a Pmf.</span></span>
<span id="cb6-34"><a href="#cb6-34"></a></span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="co">    pmf: Pmf object</span></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="co">    n: number of points</span></span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="co">    """</span></span>
<span id="cb6-38"><a href="#cb6-38"></a></span>
<span id="cb6-39"><a href="#cb6-39"></a>    <span class="cf">if</span> <span class="kw">not</span> qs:</span>
<span id="cb6-40"><a href="#cb6-40"></a>        qs <span class="op">=</span> np.linspace(pmf.qs.<span class="bu">min</span>(), pmf.qs.<span class="bu">max</span>(), n)</span>
<span id="cb6-41"><a href="#cb6-41"></a></span>
<span id="cb6-42"><a href="#cb6-42"></a>    kde <span class="op">=</span> scipy.stats.gaussian_kde(pmf.qs, weights<span class="op">=</span>pmf.ps)</span>
<span id="cb6-43"><a href="#cb6-43"></a>    ps <span class="op">=</span> kde.evaluate(qs)</span>
<span id="cb6-44"><a href="#cb6-44"></a>    pmf <span class="op">=</span> Pmf(ps, qs, <span class="op">**</span>options)</span>
<span id="cb6-45"><a href="#cb6-45"></a>    pmf.normalize()</span>
<span id="cb6-46"><a href="#cb6-46"></a></span>
<span id="cb6-47"><a href="#cb6-47"></a>    <span class="cf">return</span> pmf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="grid-method" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="grid-method"><span class="header-section-number">3</span> Grid method</h2>
<p>Given a prior and likelihood, we can compute the posterior estimation for the entire range of hypothesis</p>
<section id="parameter-grid" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="parameter-grid"><span class="header-section-number">3.1</span> 1-parameter grid</h3>
<p><strong>Steps:</strong></p>
<ol type="1">
<li><p>Define prior (<span class="math inline">\(P(H)\)</span>)</p></li>
<li><p>Define likelihood (<span class="math inline">\(P(Obs|H)\)</span>)</p></li>
<li><p>Multiply prior and likelihood (<span class="math inline">\(P(Obs|H) * P(Obs|H)\)</span>)</p></li>
<li><p>Normalize (Divide by <span class="math inline">\(P(Obs) = \sum_{i=1}^n P(H) * P(Obs_i | H)\)</span>)</p></li>
<li><p>Assert the range of your parameters covers all plausible values</p></li>
</ol>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Throwing a coin 10 times, we observe 3 tails. What is the posterior rate of tails ?</p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.485751Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.485597Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.490447Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.490193Z&quot;}" data-execution_count="7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Define prior</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>range_qs <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>pmf_prior <span class="op">=</span> Pmf(<span class="dv">1</span>, range_qs)</span>
<span id="cb7-4"><a href="#cb7-4"></a>pmf_prior.normalize()</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co"># Define likelihood</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>likelihood <span class="op">=</span> scipy.stats.binom.pmf(<span class="dv">3</span>, <span class="dv">10</span>, pmf_prior.qs)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># Multiply prior and likelihood</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>pmf_posterior <span class="op">=</span> pmf_prior <span class="op">*</span> likelihood</span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co"># Normalize</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>pmf_posterior.normalize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-code_folding="[0]" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.491884Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.491775Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.751317Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.750952Z&quot;}" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="bu">print</span>(<span class="ss">f"""Parameter value:</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="ss">    - Mean : </span><span class="sc">{</span>pmf_posterior<span class="sc">.</span>mean()<span class="sc">:.3f}</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="ss">    - 90% Credible interval: </span><span class="sc">{</span>pmf_posterior<span class="sc">.</span>credible_interval(<span class="fl">0.9</span>)<span class="sc">}</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="ss">    - Most probable value: </span><span class="sc">{</span>pmf_posterior<span class="sc">.</span>idxmax()<span class="sc">}</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="ss">"""</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>)</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a>pmf_posterior.plot(</span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="op">**</span>{</span>
<span id="cb8-10"><a href="#cb8-10"></a>        <span class="st">"title"</span>: <span class="st">"Posterior probability of parameter given observations"</span>,</span>
<span id="cb8-11"><a href="#cb8-11"></a>        <span class="st">"xlabel"</span>: <span class="st">"Parameter possible values"</span>,</span>
<span id="cb8-12"><a href="#cb8-12"></a>        <span class="st">"ylabel"</span>: <span class="st">"Probability"</span>,</span>
<span id="cb8-13"><a href="#cb8-13"></a>    }</span>
<span id="cb8-14"><a href="#cb8-14"></a>)</span>
<span id="cb8-15"><a href="#cb8-15"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Parameter value:
    - Mean : 0.333
    - 90% Credible interval: [0.14 0.56]
    - Most probable value: 0.3
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="parameters-grid" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="parameters-grid"><span class="header-section-number">3.2</span> 2-parameters grid</h3>
<p>We can use the 1-parameter grid approach with 2 parameters</p>
<p><strong>Functions:</strong></p>
<div class="cell" data-code_folding="[47]" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.753267Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.753148Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.757102Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.756849Z&quot;}" data-execution_count="9">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">def</span> make_joint(pmf1: Pmf, pmf2: Pmf) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="co">"""</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">    Compute the outer product of two Pmfs, usually priors of two parameters.</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">    Output dataframe: (columns = pmf1.qs / index = pmf2.qs)</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">    """</span></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>    X, Y <span class="op">=</span> np.meshgrid(pmf1, pmf2)</span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="cf">return</span> pd.DataFrame(X <span class="op">*</span> Y, columns<span class="op">=</span>pmf1.qs, index<span class="op">=</span>pmf2.qs)</span>
<span id="cb10-9"><a href="#cb10-9"></a></span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="kw">def</span> plot_joint(</span>
<span id="cb10-12"><a href="#cb10-12"></a>    joint: pd.DataFrame,</span>
<span id="cb10-13"><a href="#cb10-13"></a>    title: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Plot joint"</span>,</span>
<span id="cb10-14"><a href="#cb10-14"></a>    xlabel: <span class="bu">str</span> <span class="op">=</span> <span class="st">"x"</span>,</span>
<span id="cb10-15"><a href="#cb10-15"></a>    ylabel: <span class="bu">str</span> <span class="op">=</span> <span class="st">"y"</span>,</span>
<span id="cb10-16"><a href="#cb10-16"></a>    cmap: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span id="cb10-17"><a href="#cb10-17"></a>    add_contour: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb10-18"><a href="#cb10-18"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb10-19"><a href="#cb10-19"></a>    <span class="co">"""</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co">    Plot a joint distribution with a color mesh.</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="co">    x-axis: joint DataFrame columns</span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">    y-axis: joint DataFrame index</span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">    """</span></span>
<span id="cb10-24"><a href="#cb10-24"></a></span>
<span id="cb10-25"><a href="#cb10-25"></a>    vmax <span class="op">=</span> joint.to_numpy().<span class="bu">max</span>() <span class="op">*</span> <span class="fl">1.1</span></span>
<span id="cb10-26"><a href="#cb10-26"></a></span>
<span id="cb10-27"><a href="#cb10-27"></a>    plt.pcolormesh(</span>
<span id="cb10-28"><a href="#cb10-28"></a>        joint.columns,</span>
<span id="cb10-29"><a href="#cb10-29"></a>        joint.index,</span>
<span id="cb10-30"><a href="#cb10-30"></a>        joint,</span>
<span id="cb10-31"><a href="#cb10-31"></a>        cmap<span class="op">=</span>cmap,</span>
<span id="cb10-32"><a href="#cb10-32"></a>        vmax<span class="op">=</span>vmax,</span>
<span id="cb10-33"><a href="#cb10-33"></a>        shading<span class="op">=</span><span class="st">"nearest"</span>,</span>
<span id="cb10-34"><a href="#cb10-34"></a>    )</span>
<span id="cb10-35"><a href="#cb10-35"></a></span>
<span id="cb10-36"><a href="#cb10-36"></a>    plt.colorbar()</span>
<span id="cb10-37"><a href="#cb10-37"></a></span>
<span id="cb10-38"><a href="#cb10-38"></a>    <span class="cf">if</span> add_contour:</span>
<span id="cb10-39"><a href="#cb10-39"></a>        plt.contour(joint.columns, joint.index, joint, linewidths<span class="op">=</span><span class="fl">1.5</span>, cmap<span class="op">=</span><span class="st">"gray_r"</span>)</span>
<span id="cb10-40"><a href="#cb10-40"></a>    </span>
<span id="cb10-41"><a href="#cb10-41"></a>    plt.gca().<span class="bu">set</span>(title<span class="op">=</span>title, xlabel<span class="op">=</span>xlabel, ylabel<span class="op">=</span>ylabel)</span>
<span id="cb10-42"><a href="#cb10-42"></a></span>
<span id="cb10-43"><a href="#cb10-43"></a></span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="kw">def</span> joint_to_marginal(joint: pd.DataFrame) <span class="op">-&gt;</span> <span class="bu">tuple</span>[Pmf, Pmf]:</span>
<span id="cb10-45"><a href="#cb10-45"></a>    <span class="co">"""</span></span>
<span id="cb10-46"><a href="#cb10-46"></a><span class="co">    Compute the marginal distribution for a joint distribution</span></span>
<span id="cb10-47"><a href="#cb10-47"></a><span class="co">    Outuput tuple:</span></span>
<span id="cb10-48"><a href="#cb10-48"></a><span class="co">        - First distribution: marginal of columns</span></span>
<span id="cb10-49"><a href="#cb10-49"></a><span class="co">        - Second distribution: marginal of index</span></span>
<span id="cb10-50"><a href="#cb10-50"></a><span class="co">    """</span></span>
<span id="cb10-51"><a href="#cb10-51"></a></span>
<span id="cb10-52"><a href="#cb10-52"></a>    marginal_columns <span class="op">=</span> joint.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-53"><a href="#cb10-53"></a>    marginal_index <span class="op">=</span> joint.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-54"><a href="#cb10-54"></a></span>
<span id="cb10-55"><a href="#cb10-55"></a>    pmf_marginal_columns <span class="op">=</span> Pmf(marginal_columns)</span>
<span id="cb10-56"><a href="#cb10-56"></a>    pmf_marginal_index <span class="op">=</span> Pmf(marginal_index)</span>
<span id="cb10-57"><a href="#cb10-57"></a></span>
<span id="cb10-58"><a href="#cb10-58"></a>    <span class="cf">return</span> pmf_marginal_columns, pmf_marginal_index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We draw at random a man and a woman in the population.<br>
The woman is taller than the man, but we don’t know how much.<br>
→ Compute the posterior size of each one.</p>
<ul>
<li>Man prior size: Normal distribution with <span class="math inline">\((\mu, \sigma²)\)</span> = (178, 7.7)</li>
<li>Woman prior size: Normal distribution with <span class="math inline">\((\mu, \sigma²)\)</span> = (163, 7.3)</li>
</ul>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.758494Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.758320Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:09.764472Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:09.764156Z&quot;}" data-execution_count="10">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Prior</span></span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>range_size <span class="op">=</span> np.arange(<span class="dv">140</span>, <span class="dv">205</span>, <span class="fl">0.5</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>pmf_prior_size_man <span class="op">=</span> Pmf(scipy.stats.norm(<span class="dv">178</span>, <span class="fl">7.7</span>).pdf(range_size), range_size <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>pmf_prior_size_man.normalize()</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a>pmf_prior_size_woman <span class="op">=</span> Pmf(scipy.stats.norm(<span class="dv">163</span>, <span class="fl">7.3</span>).pdf(range_size), range_size)</span>
<span id="cb11-8"><a href="#cb11-8"></a>pmf_prior_size_woman.normalize()</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a>joint_prior_size <span class="op">=</span> make_joint(pmf_prior_size_man, pmf_prior_size_woman)</span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co"># Likelihood</span></span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co"># Observed: woman &gt; man</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>col_vals, index_vals <span class="op">=</span> np.meshgrid(joint_prior_size.columns, joint_prior_size.index)</span>
<span id="cb11-17"><a href="#cb11-17"></a>likelihood <span class="op">=</span> col_vals <span class="op">&lt;</span> index_vals</span>
<span id="cb11-18"><a href="#cb11-18"></a></span>
<span id="cb11-19"><a href="#cb11-19"></a></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co"># Bayes theorem</span></span>
<span id="cb11-21"><a href="#cb11-21"></a></span>
<span id="cb11-22"><a href="#cb11-22"></a>joint_posterior_size <span class="op">=</span> joint_prior_size <span class="op">*</span> likelihood</span>
<span id="cb11-23"><a href="#cb11-23"></a>joint_posterior_size <span class="op">/=</span> joint_posterior_size.<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb11-24"><a href="#cb11-24"></a></span>
<span id="cb11-25"><a href="#cb11-25"></a></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co"># Marginal</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>pmf_posterior_size_man, pmf_posterior_size_woman <span class="op">=</span> joint_to_marginal(joint_posterior_size) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-code_folding="[]" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:09.765874Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:09.765764Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:10.143363Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:10.142979Z&quot;}" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Plot results</span></span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a>plt.subplot(<span class="dv">311</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>plot_joint(joint_prior_size, title<span class="op">=</span><span class="st">"Prior size distribution"</span>, xlabel<span class="op">=</span><span class="st">"Man"</span>, ylabel<span class="op">=</span><span class="st">"Woman"</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>plt.show()</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a>plt.subplot(<span class="dv">312</span>)</span>
<span id="cb12-8"><a href="#cb12-8"></a>plot_joint(</span>
<span id="cb12-9"><a href="#cb12-9"></a>    pd.DataFrame(likelihood, columns<span class="op">=</span>joint_prior_size.columns, index<span class="op">=</span>joint_prior_size.index),</span>
<span id="cb12-10"><a href="#cb12-10"></a>    title<span class="op">=</span><span class="st">"likelihood"</span>,</span>
<span id="cb12-11"><a href="#cb12-11"></a>    xlabel<span class="op">=</span><span class="st">"Man"</span>,</span>
<span id="cb12-12"><a href="#cb12-12"></a>    ylabel<span class="op">=</span><span class="st">"Woman"</span>,</span>
<span id="cb12-13"><a href="#cb12-13"></a>)</span>
<span id="cb12-14"><a href="#cb12-14"></a>plt.show()</span>
<span id="cb12-15"><a href="#cb12-15"></a></span>
<span id="cb12-16"><a href="#cb12-16"></a>plt.subplot(<span class="dv">313</span>)</span>
<span id="cb12-17"><a href="#cb12-17"></a>pmf_prior_size_man.plot(label<span class="op">=</span><span class="st">"Prior size man (cm)"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span><span class="st">"orangered"</span>)</span>
<span id="cb12-18"><a href="#cb12-18"></a>pmf_prior_size_woman.plot(label<span class="op">=</span><span class="st">"Prior size woman (cm)"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span><span class="st">"navy"</span>)</span>
<span id="cb12-19"><a href="#cb12-19"></a>pmf_posterior_size_man.plot(label<span class="op">=</span><span class="st">"Posterior size man (cm)"</span>, color<span class="op">=</span><span class="st">"orangered"</span>)</span>
<span id="cb12-20"><a href="#cb12-20"></a>pmf_posterior_size_woman.plot(label<span class="op">=</span><span class="st">"Posterior size woman (cm)"</span>, color<span class="op">=</span><span class="st">"navy"</span>)</span>
<span id="cb12-21"><a href="#cb12-21"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Posterior marginal distributions"</span>)</span>
<span id="cb12-22"><a href="#cb12-22"></a>plt.legend()</span>
<span id="cb12-23"><a href="#cb12-23"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-12-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="probability-laws" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="probability-laws"><span class="header-section-number">4</span> Probability laws</h2>
<p>The following section introduces several probability laws and their usage in bayesin statistics</p>
<section id="binomial" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="binomial"><span class="header-section-number">4.1</span> Binomial</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given <span class="math inline">\(n\)</span> independant Bernouilli trials with a given conversion rate <span class="math inline">\(p\)</span>, the number of success is described by the binomial law</p>
<p><span class="math display">\[ X \sim B(n,p) \implies P(X=k) =  \binom{N}{k}p^{k}q^{n-k} \]</span></p>
</div>
</div>
<section id="estimating-proportion-p" class="level4" data-number="4.1.1">
<h4 data-number="4.1.1" class="anchored" data-anchor-id="estimating-proportion-p"><span class="header-section-number">4.1.1</span> Estimating proportion p</h4>
<section id="grid-method-1" class="level5" data-number="4.1.1.1">
<h5 data-number="4.1.1.1" class="anchored" data-anchor-id="grid-method-1"><span class="header-section-number">4.1.1.1</span> Grid Method</h5>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We flip a coin 10 times, we get 3 tails, what is the probability of a tail ?</p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:10.145303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:10.145165Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:10.149674Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:10.149393Z&quot;}" data-execution_count="12">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>nb_conversion, nb_trials <span class="op">=</span> <span class="dv">3</span>, <span class="dv">10</span></span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># Prior</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>range_qs <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a>pmf_prior <span class="op">=</span> Pmf(<span class="dv">1</span>, range_qs)</span>
<span id="cb13-6"><a href="#cb13-6"></a>pmf_prior.normalize()</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co"># Likelihood</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>likelihood <span class="op">=</span> scipy.stats.binom.pmf(nb_conversion, nb_trials, pmf_prior.qs)  <span class="co"># binom.pmf(k, n, p)</span></span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co"># Bayes formula</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>pmf_posterior <span class="op">=</span> pmf_prior <span class="op">*</span> likelihood</span>
<span id="cb13-13"><a href="#cb13-13"></a>pmf_posterior.normalize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="conjugate-priors" class="level5" data-number="4.1.1.2">
<h5 data-number="4.1.1.2" class="anchored" data-anchor-id="conjugate-priors"><span class="header-section-number">4.1.1.2</span> Conjugate priors</h5>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Beta distribution is the conjugate distribution of the Binomial distribution.</p>
<p>Given:</p>
<p><span class="math display">\[ prior \sim \beta(a, b) \]</span> <span class="math display">\[ nb\_conversions: k \]</span> <span class="math display">\[ nb\_trials: n \]</span></p>
<p>The posterior can be computed as:</p>
<p><span class="math display">\[ posterior \sim \beta(a + k, b + n - k) \]</span></p>
<p>To get a prior with uniform distribution between 0 and 1, we can use <em>a = b = 1</em></p>
<p><span class="math display">\[ U(0, 1) = \beta(1, 1) \]</span></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:10.151195Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:10.151076Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:10.155229Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:10.154907Z&quot;}" data-execution_count="13">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>nb_conversion, nb_trials <span class="op">=</span> <span class="dv">3</span>, <span class="dv">10</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>range_qs <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>pmf_posterior <span class="op">=</span> Pmf(scipy.stats.beta(<span class="dv">1</span> <span class="op">+</span> nb_conversion, <span class="dv">1</span> <span class="op">+</span> nb_trials <span class="op">-</span> nb_conversion).pdf(range_qs), range_qs)</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a>pmf_posterior.normalize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mcmc" class="level5" data-number="4.1.1.3">
<h5 data-number="4.1.1.3" class="anchored" data-anchor-id="mcmc"><span class="header-section-number">4.1.1.3</span> MCMC</h5>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:10.156621Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:10.156505Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:13.240472Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:13.239972Z&quot;}" data-execution_count="14">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>nb_conversion, nb_trials <span class="op">=</span> <span class="dv">3</span>, <span class="dv">10</span></span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model:</span>
<span id="cb15-5"><a href="#cb15-5"></a>    conversion_rates <span class="op">=</span> pm.Uniform(<span class="st">"conversion_rates"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a>    nb_conversion <span class="op">=</span> pm.Binomial(<span class="st">"nb_conversion"</span>, n<span class="op">=</span>nb_trials, observed<span class="op">=</span>nb_conversion, p<span class="op">=</span>conversion_rates)</span>
<span id="cb15-7"><a href="#cb15-7"></a>    trace_binom <span class="op">=</span> pm.sample(<span class="dv">1000</span>, return_inferencedata<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a></span>
<span id="cb15-9"><a href="#cb15-9"></a>posterior_samples <span class="op">=</span> trace_binom.get_values(<span class="st">"conversion_rates"</span>)</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a>pd.Series(posterior_samples).quantile([<span class="fl">0.05</span>, <span class="fl">.95</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="estimating-count" class="level4" data-number="4.1.2">
<h4 data-number="4.1.2" class="anchored" data-anchor-id="estimating-count"><span class="header-section-number">4.1.2</span> Estimating count</h4>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>On an audience of 0 to 2000 people:</p>
<ul>
<li>2 are born the 11th of may</li>
<li>1 is born the 23th of may</li>
<li>0 is born the 1st of August</li>
</ul>
<p>→ How many people is there ?</p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:13.242629Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:13.242478Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:13.248158Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:13.247870Z&quot;}" data-execution_count="15">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Prior</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>range_qs <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">2000</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>pmf_prior <span class="op">=</span> Pmf(<span class="dv">1</span>, range_qs)</span>
<span id="cb16-4"><a href="#cb16-4"></a>pmf_prior.normalize()</span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co"># Likelihood</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>likelihood <span class="op">=</span> np.ones(<span class="bu">len</span>(pmf_prior))</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="cf">for</span> nb_conversion <span class="kw">in</span> [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>]:</span>
<span id="cb16-11"><a href="#cb16-11"></a>    likelihood <span class="op">*=</span> scipy.stats.binom.pmf(nb_conversion, pmf_prior.qs, <span class="dv">1</span> <span class="op">/</span> <span class="dv">365</span>)</span>
<span id="cb16-12"><a href="#cb16-12"></a></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co"># Bayes formula</span></span>
<span id="cb16-14"><a href="#cb16-14"></a>pmf_posterior <span class="op">=</span> pmf_prior <span class="op">*</span> likelihood</span>
<span id="cb16-15"><a href="#cb16-15"></a>pmf_posterior.normalize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="multinomial" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="multinomial"><span class="header-section-number">4.2</span> Multinomial</h3>
<p>Modelize n independant trials with k possible outcomes at each trials, with a given probability for each outcome</p>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can be used in mark and recapture problem:</p>
<ul>
<li>A reviewer detects 20 errors errors on a coding’s review</li>
<li>A second reviewer detects 15 errors, among which 3 errors were detected by the first reviewer</li>
<li>Given that each reviewer has a probability p1, p2 of detecting an error, every error fall into one of those categories:</li>
</ul>
<p><span class="math display">\[ P(\bar{R_1} \cap \bar{R_2}) = (1 - p_1) * (1 - p_2) \]</span> <span class="math display">\[ P(\bar{R_1} \cap R_2) = (1 - p_1) * p_2 \]</span> <span class="math display">\[ P(R_1 \cap \bar{R_2}) = p_1 * (1 - p_2) \]</span> <span class="math display">\[ P(R_1 \cap R_2) = p_1 * p_2 \]</span></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:13.249781Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:13.249604Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:23.996745Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:23.996373Z&quot;}" data-execution_count="16">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Priors</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>range_p <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">51</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>range_nb_errors <span class="op">=</span> np.arange(<span class="dv">32</span>, <span class="dv">350</span>, <span class="dv">5</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a>cols <span class="op">=</span> [<span class="st">"p1"</span>, <span class="st">"p2"</span>, <span class="st">"nb_e"</span>]</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a>prior <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(product(range_p, range_p, range_nb_errors)), columns<span class="op">=</span>cols)</span>
<span id="cb17-8"><a href="#cb17-8"></a>prior[<span class="st">"p"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(prior)</span>
<span id="cb17-9"><a href="#cb17-9"></a></span>
<span id="cb17-10"><a href="#cb17-10"></a>prior <span class="op">=</span> Pmf(prior.set_index(cols).p)</span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="co"># Likelihood</span></span>
<span id="cb17-13"><a href="#cb17-13"></a></span>
<span id="cb17-14"><a href="#cb17-14"></a>k10 <span class="op">=</span> <span class="dv">20</span> <span class="op">-</span> <span class="dv">3</span>  <span class="co"># nb seen by first reviewer only</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>k01 <span class="op">=</span> <span class="dv">15</span> <span class="op">-</span> <span class="dv">3</span>  <span class="co"># nb seen by second reviewer only</span></span>
<span id="cb17-16"><a href="#cb17-16"></a>k11 <span class="op">=</span> <span class="dv">3</span>  <span class="co"># nb seen by both reviewers</span></span>
<span id="cb17-17"><a href="#cb17-17"></a></span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a>likelihoods <span class="op">=</span> prior.copy()</span>
<span id="cb17-20"><a href="#cb17-20"></a></span>
<span id="cb17-21"><a href="#cb17-21"></a><span class="cf">for</span> p1, p2, nb_e <span class="kw">in</span> prior.index:</span>
<span id="cb17-22"><a href="#cb17-22"></a>    k00 <span class="op">=</span> nb_e <span class="op">-</span> (k10 <span class="op">+</span> k01 <span class="op">+</span> k11)</span>
<span id="cb17-23"><a href="#cb17-23"></a></span>
<span id="cb17-24"><a href="#cb17-24"></a>    obs <span class="op">=</span> [k00, k10, k01, k11]</span>
<span id="cb17-25"><a href="#cb17-25"></a>    probs <span class="op">=</span> [</span>
<span id="cb17-26"><a href="#cb17-26"></a>        (<span class="dv">1</span> <span class="op">-</span> p1) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> p2),  <span class="co"># prob k00</span></span>
<span id="cb17-27"><a href="#cb17-27"></a>        p1 <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> p2),        <span class="co"># prob k10</span></span>
<span id="cb17-28"><a href="#cb17-28"></a>        (<span class="dv">1</span> <span class="op">-</span> p1) <span class="op">*</span> p2,        <span class="co"># prob k01</span></span>
<span id="cb17-29"><a href="#cb17-29"></a>        p1 <span class="op">*</span> p2,              <span class="co"># prob k11</span></span>
<span id="cb17-30"><a href="#cb17-30"></a>    ]</span>
<span id="cb17-31"><a href="#cb17-31"></a></span>
<span id="cb17-32"><a href="#cb17-32"></a>    likelihood <span class="op">=</span> scipy.stats.multinomial.pmf(obs, nb_e, probs)</span>
<span id="cb17-33"><a href="#cb17-33"></a></span>
<span id="cb17-34"><a href="#cb17-34"></a>    likelihoods[p1, p2, nb_e] <span class="op">=</span> likelihood</span>
<span id="cb17-35"><a href="#cb17-35"></a></span>
<span id="cb17-36"><a href="#cb17-36"></a><span class="co"># Bayes formula </span></span>
<span id="cb17-37"><a href="#cb17-37"></a>posterior <span class="op">=</span> prior <span class="op">*</span> likelihoods</span>
<span id="cb17-38"><a href="#cb17-38"></a>posterior.normalize()</span>
<span id="cb17-39"><a href="#cb17-39"></a></span>
<span id="cb17-40"><a href="#cb17-40"></a><span class="co"># Marginal </span></span>
<span id="cb17-41"><a href="#cb17-41"></a>marginal_nb_e <span class="op">=</span> Pmf(posterior.rename(<span class="st">"p"</span>).reset_index().groupby(<span class="st">"nb_e"</span>).p.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="poisson" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="poisson"><span class="header-section-number">4.3</span> Poisson</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given:</p>
<ul>
<li>An event occur at frequency <span class="math inline">\(\lambda\)</span> on a given period</li>
<li>The chances of occuring is uniform on a given period</li>
<li>The occurence of an event doesn’t impact the occurence of other events</li>
</ul>
<p>The number of event which occurend on a given period follow a Poisson distribution:</p>
<p><span class="math display">\[ P(X=k) = \frac{\lambda^k * e^{-\lambda}}{k!} \]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose we can model the number of goals of a footbal team by a poisson process. Our prior follow a gamma law of parameter 1.4.<br>
→ Compute the posterior distribution of <span class="math inline">\(\lambda\)</span> if a team score 4 goals</p>
</div>
</div>
<section id="grid-method-2" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="grid-method-2"><span class="header-section-number">4.3.1</span> Grid method</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:24.000170Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:23.999839Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:24.005297Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:24.005043Z&quot;}" data-execution_count="17">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>nb_events_obs <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># Prior</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>range_qs <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">101</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a>pmf_prior <span class="op">=</span> Pmf(scipy.stats.gamma(<span class="fl">1.4</span>).pdf(range_qs), range_qs)</span>
<span id="cb18-6"><a href="#cb18-6"></a>pmf_prior.normalize()</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co"># Likelihood</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>likelihood <span class="op">=</span> scipy.stats.poisson(pmf_prior.qs).pmf(nb_events_obs)</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co"># Bayes formula</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>pmf_posterior <span class="op">=</span> pmf_prior <span class="op">*</span> likelihood</span>
<span id="cb18-13"><a href="#cb18-13"></a>pmf_posterior.normalize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="conjugate-priors-1" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="conjugate-priors-1"><span class="header-section-number">4.3.2</span> Conjugate priors</h4>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Gamma distribution is the conjugate distribution of the Poisson distribution.</p>
<p>Given:</p>
<p><span class="math display">\[ prior \sim Gamma(\alpha, \beta) \]</span> <span class="math display">\[ nb\_event: k  \]</span> <span class="math display">\[ Duration: t \]</span></p>
<p>The posterior can be computed as:</p>
<p><span class="math display">\[ posterior \sim Gamma(\alpha + k, \beta + t) \]</span></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:24.006819Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:24.006706Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:24.010371Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:24.010128Z&quot;}" data-execution_count="18">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>alpha, beta <span class="op">=</span> <span class="fl">1.4</span>, <span class="dv">1</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>obs_k, obs_t <span class="op">=</span> <span class="dv">4</span>, <span class="dv">1</span></span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a>alpha_updated, beta_updated <span class="op">=</span> alpha <span class="op">+</span> obs_k, (beta <span class="op">+</span> obs_t)</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a>gamma_dist <span class="op">=</span> scipy.stats.gamma(alpha_updated, scale<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> beta_updated) <span class="co"># scale factor equal to 1 / b</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>                               </span>
<span id="cb19-8"><a href="#cb19-8"></a>range_qs <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">101</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a>pmf_posterior_conjugate <span class="op">=</span> Pmf(gamma_dist.pdf(range_qs), range_qs)</span>
<span id="cb19-10"><a href="#cb19-10"></a>pmf_posterior_conjugate.normalize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:24.011771Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:24.011668Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:24.241444Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:24.241004Z&quot;}" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>pmf_prior.plot(label<span class="op">=</span><span class="st">"Prior"</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a>pmf_posterior.plot(label<span class="op">=</span><span class="st">"Posterior grid method"</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a>pmf_posterior_conjugate.plot(label<span class="op">=</span><span class="st">'Posterior conjugate method'</span>, linestyle<span class="op">=</span><span class="st">"dotted"</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a>plt.legend()</span>
<span id="cb20-6"><a href="#cb20-6"></a>plt.title <span class="op">=</span> <span class="st">"Distribution of lambda"</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>plt.xlabel <span class="op">=</span> <span class="st">"Lambda"</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>plt.ylabel <span class="op">=</span> <span class="st">"Probability"</span></span>
<span id="cb20-9"><a href="#cb20-9"></a></span>
<span id="cb20-10"><a href="#cb20-10"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="mcmc-1" class="level4" data-number="4.3.3">
<h4 data-number="4.3.3" class="anchored" data-anchor-id="mcmc-1"><span class="header-section-number">4.3.3</span> MCMC</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:24.244429Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:24.244024Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:26.573262Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:26.572884Z&quot;}" data-execution_count="20">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>obs_k <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model:</span>
<span id="cb21-4"><a href="#cb21-4"></a>    lam <span class="op">=</span> pm.Gamma(<span class="st">"lambda"</span>, alpha<span class="op">=</span><span class="fl">1.4</span>, beta<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5"></a>    nb_events <span class="op">=</span> pm.Poisson(<span class="st">"nb_event"</span>, mu<span class="op">=</span>lam, observed<span class="op">=</span>obs_k)</span>
<span id="cb21-6"><a href="#cb21-6"></a>    trace <span class="op">=</span> pm.sample(<span class="dv">1000</span>, return_inferencedata<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a>posterior_samples <span class="op">=</span> trace.get_values(<span class="st">"lambda"</span>)</span>
<span id="cb21-9"><a href="#cb21-9"></a></span>
<span id="cb21-10"><a href="#cb21-10"></a>pd.Series(posterior_samples).quantile([<span class="fl">0.05</span>, <span class="fl">.95</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exponential" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="exponential"><span class="header-section-number">4.4</span> Exponential</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given the hypothesis of the Poisson distribution, the repartition of duration to the next event follows an exponential distribution:</p>
<p><span class="math display">\[ P(X=t) = \lambda * e^{-\lambda  t} \]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose we can model the number of goals of a footbal team by a poisson process. Our prior follow a gamma law of parameter 1.4.<br>
→ Compute the posterior distribution of <span class="math inline">\(\lambda\)</span> if a team scores a goal at 11th and 23th minute</p>
</div>
</div>
<section id="grid-method-3" class="level4" data-number="4.4.1">
<h4 data-number="4.4.1" class="anchored" data-anchor-id="grid-method-3"><span class="header-section-number">4.4.1</span> Grid method</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:26.575178Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:26.575046Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:26.579960Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:26.579712Z&quot;}" data-execution_count="21">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>elapsed_time_1 <span class="op">=</span> <span class="dv">11</span> <span class="op">/</span> <span class="dv">90</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>elapsed_time_2 <span class="op">=</span> (<span class="dv">23</span> <span class="op">-</span> <span class="dv">11</span>) <span class="op">/</span> <span class="dv">90</span></span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co"># Prior: range of lambda</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>range_qs <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">101</span>)</span>
<span id="cb22-6"><a href="#cb22-6"></a>pmf_prior <span class="op">=</span> Pmf(scipy.stats.gamma(<span class="fl">1.4</span>).pdf(range_qs), range_qs)</span>
<span id="cb22-7"><a href="#cb22-7"></a>pmf_prior.normalize()</span>
<span id="cb22-8"><a href="#cb22-8"></a></span>
<span id="cb22-9"><a href="#cb22-9"></a></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="co"># Likelihood</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>lams <span class="op">=</span> range_qs</span>
<span id="cb22-12"><a href="#cb22-12"></a>likelihood_1 <span class="op">=</span> lams <span class="op">*</span> np.exp(<span class="op">-</span>lams <span class="op">*</span> elapsed_time_1)</span>
<span id="cb22-13"><a href="#cb22-13"></a>likelihood_2 <span class="op">=</span> lams <span class="op">*</span> np.exp(<span class="op">-</span>lams <span class="op">*</span> elapsed_time_2)</span>
<span id="cb22-14"><a href="#cb22-14"></a></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="co"># Bayes formula</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>pmf_posterior <span class="op">=</span> pmf_prior <span class="op">*</span> likelihood_1 <span class="op">*</span> likelihood_2</span>
<span id="cb22-17"><a href="#cb22-17"></a>pmf_posterior.normalize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="normal" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="normal"><span class="header-section-number">4.5</span> Normal</h3>
<p>The aim is usually to estimate the parameters <span class="math inline">\((\mu, \sigma²)\)</span> of the normal distribution</p>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We compare the results of a given value accross a control and test group. We assume the results follow a normal distribution.<br>
→ We want to know if the difference of mean between groups is significant</p>
</div>
</div>
<section id="grid-method-4" class="level4" data-number="4.5.1">
<h4 data-number="4.5.1" class="anchored" data-anchor-id="grid-method-4"><span class="header-section-number">4.5.1</span> Grid method</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:26.581692Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:26.581486Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:26.657460Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:26.656723Z&quot;}" data-execution_count="22">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>control_obs <span class="op">=</span> [<span class="dv">24</span>, <span class="dv">43</span>, <span class="dv">58</span>, <span class="dv">71</span>, <span class="dv">43</span>, <span class="dv">49</span>, <span class="dv">61</span>, <span class="dv">44</span>, <span class="dv">67</span>, <span class="dv">49</span>, <span class="dv">53</span>, <span class="dv">56</span>, <span class="dv">59</span>, <span class="dv">52</span>, <span class="dv">62</span>, <span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">33</span>, <span class="dv">46</span>, <span class="dv">43</span>, <span class="dv">57</span>]</span>
<span id="cb23-2"><a href="#cb23-2"></a>test_obs <span class="op">=</span> [<span class="dv">42</span>, <span class="dv">43</span>, <span class="dv">55</span>, <span class="dv">26</span>, <span class="dv">62</span>, <span class="dv">37</span>, <span class="dv">33</span>, <span class="dv">41</span>, <span class="dv">19</span>, <span class="dv">54</span>, <span class="dv">20</span>, <span class="dv">85</span>, <span class="dv">46</span>, <span class="dv">10</span>, <span class="dv">17</span>, <span class="dv">60</span>, <span class="dv">53</span>, <span class="dv">42</span>, <span class="dv">37</span>, <span class="dv">42</span>, <span class="dv">55</span>, <span class="dv">28</span>, <span class="dv">48</span>]</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co"># Define priors</span></span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a>range_mu <span class="op">=</span> np.linspace(<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">201</span>)</span>
<span id="cb23-8"><a href="#cb23-8"></a>pmf_prior_mu <span class="op">=</span> Pmf(<span class="dv">1</span>, range_mu)</span>
<span id="cb23-9"><a href="#cb23-9"></a>pmf_prior_mu.normalize()</span>
<span id="cb23-10"><a href="#cb23-10"></a></span>
<span id="cb23-11"><a href="#cb23-11"></a>range_sigma <span class="op">=</span> np.linspace(<span class="dv">7</span>, <span class="dv">30</span>, <span class="dv">201</span>)</span>
<span id="cb23-12"><a href="#cb23-12"></a>pmf_prior_sigma <span class="op">=</span> Pmf(<span class="dv">1</span>, range_sigma)</span>
<span id="cb23-13"><a href="#cb23-13"></a>pmf_prior_sigma.normalize()</span>
<span id="cb23-14"><a href="#cb23-14"></a></span>
<span id="cb23-15"><a href="#cb23-15"></a>prior_joint <span class="op">=</span> make_joint(pmf_prior_mu, pmf_prior_sigma)</span>
<span id="cb23-16"><a href="#cb23-16"></a></span>
<span id="cb23-17"><a href="#cb23-17"></a></span>
<span id="cb23-18"><a href="#cb23-18"></a><span class="co"># Likelihood</span></span>
<span id="cb23-19"><a href="#cb23-19"></a></span>
<span id="cb23-20"><a href="#cb23-20"></a><span class="co"># Control group</span></span>
<span id="cb23-21"><a href="#cb23-21"></a>mu_mesh, sigma_mesh, obs_mesh <span class="op">=</span> np.meshgrid(pmf_prior_mu.qs, pmf_prior_sigma.qs, control_obs)</span>
<span id="cb23-22"><a href="#cb23-22"></a>likelihood_control <span class="op">=</span> scipy.stats.norm(mu_mesh, sigma_mesh).pdf(obs_mesh)</span>
<span id="cb23-23"><a href="#cb23-23"></a>likelihood_control <span class="op">=</span> likelihood_control.prod(axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb23-24"><a href="#cb23-24"></a></span>
<span id="cb23-25"><a href="#cb23-25"></a><span class="co"># Test group</span></span>
<span id="cb23-26"><a href="#cb23-26"></a>mu_mesh, sigma_mesh, obs_mesh <span class="op">=</span> np.meshgrid(pmf_prior_mu.qs, pmf_prior_sigma.qs, test_obs)</span>
<span id="cb23-27"><a href="#cb23-27"></a>likelihood_test <span class="op">=</span> scipy.stats.norm(mu_mesh, sigma_mesh).pdf(obs_mesh)</span>
<span id="cb23-28"><a href="#cb23-28"></a>likelihood_test <span class="op">=</span> likelihood_test.prod(axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb23-29"><a href="#cb23-29"></a></span>
<span id="cb23-30"><a href="#cb23-30"></a></span>
<span id="cb23-31"><a href="#cb23-31"></a><span class="co"># Bayes formula</span></span>
<span id="cb23-32"><a href="#cb23-32"></a>posterior_joint_control <span class="op">=</span> prior_joint <span class="op">*</span> likelihood_control</span>
<span id="cb23-33"><a href="#cb23-33"></a>posterior_joint_control <span class="op">/=</span> posterior_joint_control.<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb23-34"><a href="#cb23-34"></a></span>
<span id="cb23-35"><a href="#cb23-35"></a>posterior_joint_test <span class="op">=</span> prior_joint <span class="op">*</span> likelihood_test</span>
<span id="cb23-36"><a href="#cb23-36"></a>posterior_joint_test <span class="op">/=</span> posterior_joint_test.<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb23-37"><a href="#cb23-37"></a></span>
<span id="cb23-38"><a href="#cb23-38"></a></span>
<span id="cb23-39"><a href="#cb23-39"></a><span class="co"># Marginal</span></span>
<span id="cb23-40"><a href="#cb23-40"></a>pmf_posterior_mu_control, pmf_posterior_sigma_control <span class="op">=</span> joint_to_marginal(posterior_joint_control)</span>
<span id="cb23-41"><a href="#cb23-41"></a>pmf_posterior_mu_test, pmf_posterior_sigma_test <span class="op">=</span> joint_to_marginal(posterior_joint_test)</span>
<span id="cb23-42"><a href="#cb23-42"></a></span>
<span id="cb23-43"><a href="#cb23-43"></a><span class="co"># Diff of mu</span></span>
<span id="cb23-44"><a href="#cb23-44"></a>posterior_mu_diff <span class="op">=</span> pmf_posterior_mu_control.sub_dist(pmf_posterior_mu_test)</span>
<span id="cb23-45"><a href="#cb23-45"></a>posterior_mu_diff <span class="op">=</span> kde_from_pmf(posterior_mu_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:26.659998Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:26.659757Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:27.127137Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:27.126797Z&quot;}" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>plt.subplot(<span class="dv">221</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a>plt.contour(posterior_joint_control)</span>
<span id="cb24-3"><a href="#cb24-3"></a>plt.contour(posterior_joint_test)</span>
<span id="cb24-4"><a href="#cb24-4"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Joint posterior density"</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a>plt.subplot(<span class="dv">222</span>)</span>
<span id="cb24-7"><a href="#cb24-7"></a>pmf_posterior_mu_control.plot(label<span class="op">=</span><span class="st">"Control mu"</span>)</span>
<span id="cb24-8"><a href="#cb24-8"></a>pmf_posterior_mu_test.plot(label<span class="op">=</span><span class="st">"Test mu"</span>)</span>
<span id="cb24-9"><a href="#cb24-9"></a>plt.legend()</span>
<span id="cb24-10"><a href="#cb24-10"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Marginal posterior density of mu"</span>)</span>
<span id="cb24-11"><a href="#cb24-11"></a></span>
<span id="cb24-12"><a href="#cb24-12"></a>plt.subplot(<span class="dv">223</span>)</span>
<span id="cb24-13"><a href="#cb24-13"></a>pmf_posterior_sigma_control.plot(label<span class="op">=</span><span class="st">"Control sigma"</span>)</span>
<span id="cb24-14"><a href="#cb24-14"></a>pmf_posterior_sigma_test.plot(label<span class="op">=</span><span class="st">"Test sigma"</span>)</span>
<span id="cb24-15"><a href="#cb24-15"></a>plt.legend()</span>
<span id="cb24-16"><a href="#cb24-16"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Marginal posterior density of sigma"</span>)</span>
<span id="cb24-17"><a href="#cb24-17"></a></span>
<span id="cb24-18"><a href="#cb24-18"></a>plt.subplot(<span class="dv">224</span>)</span>
<span id="cb24-19"><a href="#cb24-19"></a>posterior_mu_diff.plot(label<span class="op">=</span><span class="st">"Difference mu"</span>)</span>
<span id="cb24-20"><a href="#cb24-20"></a>plt.legend()</span>
<span id="cb24-21"><a href="#cb24-21"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Posterior mu difference"</span>)</span>
<span id="cb24-22"><a href="#cb24-22"></a></span>
<span id="cb24-23"><a href="#cb24-23"></a></span>
<span id="cb24-24"><a href="#cb24-24"></a>plt.tight_layout()</span>
<span id="cb24-25"><a href="#cb24-25"></a></span>
<span id="cb24-26"><a href="#cb24-26"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="mcmc-2" class="level4" data-number="4.5.2">
<h4 data-number="4.5.2" class="anchored" data-anchor-id="mcmc-2"><span class="header-section-number">4.5.2</span> MCMC</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:27.128872Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:27.128757Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:31.303261Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:31.302825Z&quot;}" data-execution_count="24">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model:</span>
<span id="cb25-2"><a href="#cb25-2"></a>    mu <span class="op">=</span> pm.Uniform(<span class="st">"mu"</span>, <span class="dv">30</span>, <span class="dv">60</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a>    sigma <span class="op">=</span> pm.Uniform(<span class="st">"sigma"</span>, <span class="dv">7</span>, <span class="dv">30</span>)</span>
<span id="cb25-4"><a href="#cb25-4"></a>    result <span class="op">=</span> pm.Normal(<span class="st">"result"</span>, mu<span class="op">=</span>mu, sigma<span class="op">=</span>sigma, observed<span class="op">=</span>control_obs)</span>
<span id="cb25-5"><a href="#cb25-5"></a>    trace_binom <span class="op">=</span> pm.sample(<span class="dv">1000</span>, return_inferencedata<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-6"><a href="#cb25-6"></a></span>
<span id="cb25-7"><a href="#cb25-7"></a>posterior_samples <span class="op">=</span> trace_binom.get_values(<span class="st">"mu"</span>)</span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a>pd.Series(posterior_samples).quantile([<span class="fl">0.05</span>, <span class="fl">.95</span>]).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="weibull" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="weibull"><span class="header-section-number">4.6</span> Weibull</h3>
<p>The Weibull distribution is used in survival analysis to predict time until an event (e.g.&nbsp;death)<br>
Here we’ll use the <em>weibull_min</em> implementation of scipy. Given a parameter <span class="math inline">\(\lambda\)</span> and <em>k</em> its pdf describe the time until an event</p>
<section id="parameters-influence" class="level4" data-number="4.6.1">
<h4 data-number="4.6.1" class="anchored" data-anchor-id="parameters-influence"><span class="header-section-number">4.6.1</span> Parameters’ influence</h4>
<ul>
<li><span class="math inline">\(\lambda\)</span>: Mean of lifetime</li>
<li><span class="math inline">\(k\)</span>: Shape</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:31.305557Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:31.305133Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:31.630279Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:31.629932Z&quot;}" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>range_wb <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">101</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="cf">for</span> lam <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>]:</span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">3</span>]:</span>
<span id="cb26-7"><a href="#cb26-7"></a>        sns.lineplot(scipy.stats.weibull_min(c<span class="op">=</span>k, scale<span class="op">=</span>lam).pdf(range_wb), label<span class="op">=</span><span class="ss">f"(lam;k) = (</span><span class="sc">{</span>lam<span class="sc">}</span><span class="ss">;</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">)"</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>])</span>
<span id="cb26-8"><a href="#cb26-8"></a></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="cf">for</span> lam <span class="kw">in</span> [<span class="dv">3</span>]:</span>
<span id="cb26-10"><a href="#cb26-10"></a>    <span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>]:</span>
<span id="cb26-11"><a href="#cb26-11"></a>        sns.lineplot(scipy.stats.weibull_min(c<span class="op">=</span>k, scale<span class="op">=</span>lam).pdf(range_wb), label<span class="op">=</span><span class="ss">f"(lam;k) = (</span><span class="sc">{</span>lam<span class="sc">}</span><span class="ss">;</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">)"</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>])</span>
<span id="cb26-12"><a href="#cb26-12"></a></span>
<span id="cb26-13"><a href="#cb26-13"></a></span>
<span id="cb26-14"><a href="#cb26-14"></a>axs[<span class="dv">0</span>].title.set_text(<span class="st">'Variation of lambda'</span>)</span>
<span id="cb26-15"><a href="#cb26-15"></a>axs[<span class="dv">1</span>].title.set_text(<span class="st">'Variation of k'</span>)</span>
<span id="cb26-16"><a href="#cb26-16"></a></span>
<span id="cb26-17"><a href="#cb26-17"></a>plt.tight_layout()</span>
<span id="cb26-18"><a href="#cb26-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We stop an experiment 8 years after the beginning<br>
Some subjects arrived during the experiment, some died and some survived<br>
Suppose we can model their lifetime by the Weibull distribution<br>
→ Compute the distribution of <span class="math inline">\(k\)</span> and <span class="math inline">\(\lambda\)</span></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:31.632588Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:31.632241Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:31.638166Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:31.637904Z&quot;}" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Generate distribution and observations</span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co"># Distribution</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>k, lam <span class="op">=</span> <span class="fl">0.8</span>, <span class="dv">3</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>actual_dist <span class="op">=</span> scipy.stats.weibull_min(c<span class="op">=</span>k, scale<span class="op">=</span>lam)</span>
<span id="cb27-8"><a href="#cb27-8"></a></span>
<span id="cb27-9"><a href="#cb27-9"></a></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="co"># Observations</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>obs_time <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>nb_obs <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb27-13"><a href="#cb27-13"></a></span>
<span id="cb27-14"><a href="#cb27-14"></a>start <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">8</span>, size<span class="op">=</span>nb_obs)</span>
<span id="cb27-15"><a href="#cb27-15"></a>duration <span class="op">=</span> actual_dist.rvs(size<span class="op">=</span>nb_obs, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb27-16"><a href="#cb27-16"></a></span>
<span id="cb27-17"><a href="#cb27-17"></a>df_obs <span class="op">=</span> pd.DataFrame({<span class="st">"start"</span>: start,<span class="st">"duration"</span>: duration,}).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb27-18"><a href="#cb27-18"></a>df_obs[<span class="st">"end"</span>] <span class="op">=</span> df_obs[<span class="st">"start"</span>] <span class="op">+</span> df_obs[<span class="st">"duration"</span>]</span>
<span id="cb27-19"><a href="#cb27-19"></a></span>
<span id="cb27-20"><a href="#cb27-20"></a>df_obs[<span class="st">"censored"</span>] <span class="op">=</span> df_obs[<span class="st">"end"</span>] <span class="op">&gt;</span> obs_time</span>
<span id="cb27-21"><a href="#cb27-21"></a>df_obs[<span class="st">"obs_t"</span>] <span class="op">=</span> df_obs[<span class="st">"end"</span>].clip(upper<span class="op">=</span><span class="dv">8</span>) <span class="op">-</span> df_obs[<span class="st">"start"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:31.639669Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:31.639494Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:31.773462Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:31.773118Z&quot;}" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>plt.hlines(</span>
<span id="cb28-2"><a href="#cb28-2"></a>    y<span class="op">=</span>df_obs.index,</span>
<span id="cb28-3"><a href="#cb28-3"></a>    xmin<span class="op">=</span>df_obs.start,</span>
<span id="cb28-4"><a href="#cb28-4"></a>    xmax<span class="op">=</span>df_obs.end,</span>
<span id="cb28-5"><a href="#cb28-5"></a>    color<span class="op">=</span>df_obs.censored.<span class="bu">apply</span>(<span class="kw">lambda</span> c: <span class="st">'blue'</span> <span class="cf">if</span> <span class="kw">not</span> c <span class="cf">else</span> <span class="st">"red"</span>),</span>
<span id="cb28-6"><a href="#cb28-6"></a>    alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb28-7"><a href="#cb28-7"></a></span>
<span id="cb28-8"><a href="#cb28-8"></a>plt.scatter(df_obs.end, df_obs.index, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb28-9"><a href="#cb28-9"></a>plt.axvline(x<span class="op">=</span>obs_time)</span>
<span id="cb28-10"><a href="#cb28-10"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Subjects' lifetime"</span>, xlabel<span class="op">=</span><span class="st">"Lifetime"</span>, ylabel<span class="op">=</span><span class="st">"Subject n°"</span>)</span>
<span id="cb28-11"><a href="#cb28-11"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:31.775040Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:31.774924Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:31.781407Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:31.781151Z&quot;}" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>df_obs.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<caption>Example of subject’s data </caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start</th>
<th data-quarto-table-cell-role="th">duration</th>
<th data-quarto-table-cell-role="th">end</th>
<th data-quarto-table-cell-role="th">censored</th>
<th data-quarto-table-cell-role="th">obs_t</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.34</td>
<td>1.17</td>
<td>4.51</td>
<td>False</td>
<td>1.17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.76</td>
<td>11.89</td>
<td>17.65</td>
<td>True</td>
<td>2.24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.00</td>
<td>4.23</td>
<td>4.23</td>
<td>False</td>
<td>4.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2.42</td>
<td>2.68</td>
<td>5.10</td>
<td>False</td>
<td>2.68</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.17</td>
<td>0.33</td>
<td>1.50</td>
<td>False</td>
<td>0.33</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="grid-method-5" class="level4" data-number="4.6.2">
<h4 data-number="4.6.2" class="anchored" data-anchor-id="grid-method-5"><span class="header-section-number">4.6.2</span> Grid method</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:31.782898Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:31.782788Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:31.798853Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:31.798472Z&quot;}" data-execution_count="29">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Define priors</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>range_k <span class="op">=</span> np.linspace(<span class="fl">0.1</span>, <span class="dv">2</span>, <span class="dv">101</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>pmf_prior_k <span class="op">=</span> Pmf(<span class="dv">1</span>, range_k)</span>
<span id="cb30-4"><a href="#cb30-4"></a>pmf_prior_k.normalize()</span>
<span id="cb30-5"><a href="#cb30-5"></a></span>
<span id="cb30-6"><a href="#cb30-6"></a>range_lam <span class="op">=</span> np.linspace(<span class="fl">0.1</span>, <span class="dv">6</span>, <span class="dv">101</span>)</span>
<span id="cb30-7"><a href="#cb30-7"></a>pmf_prior_lam <span class="op">=</span> Pmf(<span class="dv">1</span>, range_lam)</span>
<span id="cb30-8"><a href="#cb30-8"></a>pmf_prior_lam.normalize()</span>
<span id="cb30-9"><a href="#cb30-9"></a></span>
<span id="cb30-10"><a href="#cb30-10"></a>joint_prior <span class="op">=</span> make_joint(pmf_prior_k, pmf_prior_lam)</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="co"># Likelihood</span></span>
<span id="cb30-13"><a href="#cb30-13"></a></span>
<span id="cb30-14"><a href="#cb30-14"></a>k_mesh, lam_mesh, time_mesh <span class="op">=</span> np.meshgrid(range_k, range_lam, df_obs[<span class="op">~</span>df_obs.censored].obs_t)</span>
<span id="cb30-15"><a href="#cb30-15"></a>likelihood_uncensored <span class="op">=</span> scipy.stats.weibull_min(c<span class="op">=</span>k_mesh, scale<span class="op">=</span>lam_mesh).pdf(time_mesh)</span>
<span id="cb30-16"><a href="#cb30-16"></a>likelihood_uncensored <span class="op">=</span> likelihood_uncensored.prod(axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb30-17"><a href="#cb30-17"></a></span>
<span id="cb30-18"><a href="#cb30-18"></a>k_mesh, lam_mesh, time_mesh <span class="op">=</span> np.meshgrid(range_k, range_lam, df_obs[df_obs.censored].obs_t)</span>
<span id="cb30-19"><a href="#cb30-19"></a>likelihood_censored <span class="op">=</span> scipy.stats.weibull_min(c<span class="op">=</span>k_mesh, scale<span class="op">=</span>lam_mesh).sf(time_mesh)</span>
<span id="cb30-20"><a href="#cb30-20"></a>likelihood_censored <span class="op">=</span> likelihood_censored.prod(axis<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb30-21"><a href="#cb30-21"></a></span>
<span id="cb30-22"><a href="#cb30-22"></a></span>
<span id="cb30-23"><a href="#cb30-23"></a><span class="co"># Bayes formula</span></span>
<span id="cb30-24"><a href="#cb30-24"></a>joint_posterior <span class="op">=</span> joint_prior <span class="op">*</span> likelihood_uncensored <span class="op">*</span> likelihood_censored</span>
<span id="cb30-25"><a href="#cb30-25"></a>joint_posterior <span class="op">/=</span> joint_posterior.<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb30-26"><a href="#cb30-26"></a></span>
<span id="cb30-27"><a href="#cb30-27"></a></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="co"># Marginal</span></span>
<span id="cb30-29"><a href="#cb30-29"></a>posterior_k, posterior_lam <span class="op">=</span> joint_to_marginal(joint_posterior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>TODO:</strong></p>
<ul>
<li>Add MCMC with censor and uncensored data</li>
<li>Add Hypergeometric distribution</li>
</ul>
</section>
</section>
</section>
<section id="regression" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="regression"><span class="header-section-number">5</span> Regression</h2>
<section id="logistic-regression" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">5.1</span> Logistic regression</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>To demonstrate the logisic regression formula, we can use the following:</p>
<p><span class="math display">\[ O(H|obs) = O(H) * \frac{P(Obs|H)}{P(Obs|\bar{H})} \]</span></p>
<p><span class="math display">\[
O(x) = \frac{P(x)}{1 - P(x)}
\]</span></p>
<p>If observations are independant, then,</p>
<p><span class="math display">\[
O(H|obs^n) = O(H) * (\frac{P(Obs|H)}{P(Obs|\bar{H})})^n
\]</span></p>
<p><span class="math display">\[
\implies log(O(H|obs^n)) = log(O(H)) + n *log(\frac{P(Obs|H)}{P(Obs|\bar{H})})
\]</span></p>
<p><span class="math display">\[
\implies O(H|obs^n) = e^{log(O(H)) + n *log(\frac{P(Obs|H)}{P(Obs|\bar{H})})}
\]</span></p>
<p><span class="math display">\[
\implies O(H|obs^n) = e^{a * x + b}
\]</span></p>
<p><span class="math display">\[
\implies P(H|obs^n) = \frac{1}{1 + e^{-(a*x+b)}}
\]</span></p>
<p>With:<br>
<span class="math display">\[ a =log (\frac{P(Obs|H)}{P(Obs|\bar{H})}): Log \: likelihood \:ratio \]</span> <span class="math display">\[ b = log(O(H)): prior \]</span></p>
</div>
</div>
<p>The aim is to define the value of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span></p>
<section id="grid-method-6" class="level4" data-number="5.1.1">
<h4 data-number="5.1.1" class="anchored" data-anchor-id="grid-method-6"><span class="header-section-number">5.1.1</span> Grid method</h4>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We look at the risk of accident given a temperature.<br>
We assume this can be modelled by a logistic regression.<br>
In the following we have: <span class="math inline">\((a: slope)\)</span> and <span class="math inline">\((b: intercept)\)</span></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:31.802051Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:31.801720Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:31.805661Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:31.805404Z&quot;}" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>temp <span class="op">=</span> [<span class="dv">66</span>, <span class="dv">70</span>, <span class="dv">69</span>, <span class="dv">68</span>, <span class="dv">67</span>, <span class="dv">72</span>, <span class="dv">73</span>, <span class="dv">70</span>, <span class="dv">57</span>, <span class="dv">63</span>, <span class="dv">70</span>, <span class="dv">78</span>, <span class="dv">67</span>, <span class="dv">53</span>, <span class="dv">67</span>, <span class="dv">75</span>, <span class="dv">70</span>, <span class="dv">81</span>, <span class="dv">76</span>, <span class="dv">79</span>, <span class="dv">75</span>, <span class="dv">76</span>, <span class="dv">58</span>]</span>
<span id="cb31-2"><a href="#cb31-2"></a>converted <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">"temp"</span>: temp, <span class="st">"conv"</span>: converted})</span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co"># Normalize data</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>offset <span class="op">=</span> df[<span class="st">"temp"</span>].mean()</span>
<span id="cb31-8"><a href="#cb31-8"></a>df[<span class="st">"x"</span>] <span class="op">=</span> df[<span class="st">"temp"</span>] <span class="op">-</span> offset</span>
<span id="cb31-9"><a href="#cb31-9"></a>df[<span class="st">"y"</span>] <span class="op">=</span> df[<span class="st">"conv"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:31.807037Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:31.806930Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:33.631102Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:33.630723Z&quot;}" data-execution_count="31">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Priors</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>range_a <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="dv">51</span>)</span>
<span id="cb32-3"><a href="#cb32-3"></a>range_b <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">51</span>)</span>
<span id="cb32-4"><a href="#cb32-4"></a></span>
<span id="cb32-5"><a href="#cb32-5"></a>cols <span class="op">=</span> [<span class="st">"a"</span>, <span class="st">"b"</span>]</span>
<span id="cb32-6"><a href="#cb32-6"></a></span>
<span id="cb32-7"><a href="#cb32-7"></a>prior <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(product(range_a, range_b)), columns<span class="op">=</span>cols)</span>
<span id="cb32-8"><a href="#cb32-8"></a>prior[<span class="st">"p"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(prior)</span>
<span id="cb32-9"><a href="#cb32-9"></a></span>
<span id="cb32-10"><a href="#cb32-10"></a>prior <span class="op">=</span> Pmf(prior.set_index(cols).p)</span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co"># Likelihood</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>likelihood <span class="op">=</span> prior.copy()</span>
<span id="cb32-15"><a href="#cb32-15"></a></span>
<span id="cb32-16"><a href="#cb32-16"></a><span class="cf">for</span> a, b <span class="kw">in</span> prior.index:</span>
<span id="cb32-17"><a href="#cb32-17"></a>    likelihoods_converted <span class="op">=</span> scipy.special.expit(a <span class="op">*</span> df[df.y <span class="op">==</span> <span class="dv">1</span>].x <span class="op">+</span> b)</span>
<span id="cb32-18"><a href="#cb32-18"></a>    likelihoods_not_converted <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> scipy.special.expit((a <span class="op">*</span> df[df.y <span class="op">==</span> <span class="dv">0</span>].x <span class="op">+</span> b))</span>
<span id="cb32-19"><a href="#cb32-19"></a></span>
<span id="cb32-20"><a href="#cb32-20"></a>    likelihood[a, b] <span class="op">=</span> likelihoods_converted.prod() <span class="op">*</span> likelihoods_not_converted.prod()</span>
<span id="cb32-21"><a href="#cb32-21"></a></span>
<span id="cb32-22"><a href="#cb32-22"></a></span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="co"># Bayes formula</span></span>
<span id="cb32-24"><a href="#cb32-24"></a>posterior <span class="op">=</span> prior <span class="op">*</span> likelihood</span>
<span id="cb32-25"><a href="#cb32-25"></a>posterior <span class="op">/=</span> posterior.<span class="bu">sum</span>()</span>
<span id="cb32-26"><a href="#cb32-26"></a></span>
<span id="cb32-27"><a href="#cb32-27"></a><span class="co"># Posterior marginal</span></span>
<span id="cb32-28"><a href="#cb32-28"></a>posterior_a <span class="op">=</span> Pmf(posterior.rename(<span class="st">"p"</span>).reset_index().groupby(<span class="st">"a"</span>).p.<span class="bu">sum</span>())</span>
<span id="cb32-29"><a href="#cb32-29"></a>posterior_b <span class="op">=</span> Pmf(posterior.rename(<span class="st">"p"</span>).reset_index().groupby(<span class="st">"b"</span>).p.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mcmc---pymc" class="level4" data-number="5.1.2">
<h4 data-number="5.1.2" class="anchored" data-anchor-id="mcmc---pymc"><span class="header-section-number">5.1.2</span> MCMC - PyMC</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:33.634344Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:33.633947Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:38.073122Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:38.072681Z&quot;}" data-execution_count="32">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model:</span>
<span id="cb33-2"><a href="#cb33-2"></a>    a <span class="op">=</span> pm.Uniform(<span class="st">"a"</span>, <span class="op">-</span><span class="fl">0.8</span>, <span class="fl">0.1</span>)</span>
<span id="cb33-3"><a href="#cb33-3"></a>    b <span class="op">=</span> pm.Uniform(<span class="st">"b"</span>, <span class="op">-</span><span class="dv">5</span>, <span class="dv">1</span>)</span>
<span id="cb33-4"><a href="#cb33-4"></a>    </span>
<span id="cb33-5"><a href="#cb33-5"></a>    est_expit <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span> (a <span class="op">*</span> df.x <span class="op">+</span> b)))</span>
<span id="cb33-6"><a href="#cb33-6"></a>    bernouilli <span class="op">=</span> pm.Bernoulli(<span class="st">'trials'</span>, p<span class="op">=</span>est_expit, observed<span class="op">=</span>df.y)</span>
<span id="cb33-7"><a href="#cb33-7"></a>    </span>
<span id="cb33-8"><a href="#cb33-8"></a>    trace_binom <span class="op">=</span> pm.sample(<span class="dv">1000</span>, return_inferencedata<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-9"><a href="#cb33-9"></a></span>
<span id="cb33-10"><a href="#cb33-10"></a>a_posterior_samples <span class="op">=</span> trace_binom.get_values(<span class="st">"a"</span>)</span>
<span id="cb33-11"><a href="#cb33-11"></a>b_posterior_samples <span class="op">=</span> trace_binom.get_values(<span class="st">"b"</span>)</span>
<span id="cb33-12"><a href="#cb33-12"></a></span>
<span id="cb33-13"><a href="#cb33-13"></a>posterior_samples <span class="op">=</span>pd.DataFrame({<span class="st">"a"</span>: a_posterior_samples, <span class="st">"b"</span>:b_posterior_samples})</span>
<span id="cb33-14"><a href="#cb33-14"></a>posterior_samples.mean().<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mcmc---bambi" class="level4" data-number="5.1.3">
<h4 data-number="5.1.3" class="anchored" data-anchor-id="mcmc---bambi"><span class="header-section-number">5.1.3</span> MCMC - Bambi</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:38.075179Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:38.075021Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:41.728339Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:41.727942Z&quot;}" data-execution_count="33">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>model <span class="op">=</span> bmb.Model(<span class="st">"y ~ x"</span>, df, family<span class="op">=</span><span class="st">"bernoulli"</span>)</span>
<span id="cb34-2"><a href="#cb34-2"></a>fitted <span class="op">=</span> model.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:41.730903Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:41.730504Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:41.748391Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:41.748049Z&quot;}" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>az.summary(fitted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
<th data-quarto-table-cell-role="th">mcse_mean</th>
<th data-quarto-table-cell-role="th">mcse_sd</th>
<th data-quarto-table-cell-role="th">ess_bulk</th>
<th data-quarto-table-cell-role="th">ess_tail</th>
<th data-quarto-table-cell-role="th">r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>-1.116</td>
<td>0.553</td>
<td>-2.164</td>
<td>-0.103</td>
<td>0.010</td>
<td>0.007</td>
<td>3238.0</td>
<td>2712.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x</td>
<td>-0.249</td>
<td>0.106</td>
<td>-0.455</td>
<td>-0.061</td>
<td>0.002</td>
<td>0.001</td>
<td>3294.0</td>
<td>2698.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="interpretation" class="level4" data-number="5.1.4">
<h4 data-number="5.1.4" class="anchored" data-anchor-id="interpretation"><span class="header-section-number">5.1.4</span> Interpretation</h4>
<section id="interpretation-of-intercept" class="level5" data-number="5.1.4.1">
<h5 data-number="5.1.4.1" class="anchored" data-anchor-id="interpretation-of-intercept"><span class="header-section-number">5.1.4.1</span> Interpretation of intercept</h5>
<p>We can use the posterior distribution of the intercept to get the probability when x = 0:</p>
<p><span class="math inline">\(b = log(O(H)) \implies P(H) = \frac{1}{1 + e^{-b}}\)</span></p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:41.749913Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:41.749798Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:41.752250Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:41.751993Z&quot;}" data-execution_count="35">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>qs <span class="op">=</span> posterior_b.qs</span>
<span id="cb36-2"><a href="#cb36-2"></a>ps <span class="op">=</span> posterior_b.ps</span>
<span id="cb36-3"><a href="#cb36-3"></a></span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a>pmf_at_0 <span class="op">=</span> Pmf(ps, scipy.special.expit(qs))</span>
<span id="cb36-6"><a href="#cb36-6"></a></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="co"># identical as :</span></span>
<span id="cb36-8"><a href="#cb36-8"></a>pmf_at_0 <span class="op">=</span> posterior_b.transform(scipy.special.expit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:41.753692Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:41.753534Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:41.901405Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:41.901044Z&quot;}" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>pmf_at_0.plot()</span>
<span id="cb37-2"><a href="#cb37-2"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"P(y=1|x=0),  Here T° = Offset = 70°"</span>, xlabel<span class="op">=</span><span class="st">"P(y=1) at 70°"</span>, ylabel<span class="op">=</span><span class="st">"PDF"</span>)</span>
<span id="cb37-3"><a href="#cb37-3"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="interpretation-of-slope" class="level5" data-number="5.1.4.2">
<h5 data-number="5.1.4.2" class="anchored" data-anchor-id="interpretation-of-slope"><span class="header-section-number">5.1.4.2</span> Interpretation of slope</h5>
<p>The distribution of <span class="math inline">\(a\)</span> gives us the log likelihood ratio so:</p>
<p><span class="math display">\[ a = log (\frac{P(Obs|H)}{P(Obs|\bar{H})})
\implies
likelihood \: ratio = \frac{P(Obs|H)}{P(Obs|\bar{H})} = e^a
\]</span></p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:41.903112Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:41.902980Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:41.905836Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:41.905506Z&quot;}" data-execution_count="37">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>ps <span class="op">=</span> posterior_a.ps</span>
<span id="cb38-2"><a href="#cb38-2"></a>qs <span class="op">=</span> posterior_a.qs</span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a>pmf_likelihood_ratio <span class="op">=</span> Pmf(ps, np.exp(qs))</span>
<span id="cb38-5"><a href="#cb38-5"></a></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="co"># identical as:</span></span>
<span id="cb38-7"><a href="#cb38-7"></a>pmf_likelihood_ratio <span class="op">=</span> posterior_a.transform(np.exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:41.907377Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:41.907183Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:42.015468Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:42.015040Z&quot;}" data-execution_count="38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>pmf_likelihood_ratio.plot()</span>
<span id="cb39-2"><a href="#cb39-2"></a>plt.gca().<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Posterior marginal distribution off likelihood ratio"</span>, xlabel<span class="op">=</span><span class="st">"Likelihood ratio of 1°"</span>, ylabel<span class="op">=</span><span class="st">"PDF"</span>)</span>
<span id="cb39-3"><a href="#cb39-3"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="uncertainty-on-logistic-curve" class="level5" data-number="5.1.4.3">
<h5 data-number="5.1.4.3" class="anchored" data-anchor-id="uncertainty-on-logistic-curve"><span class="header-section-number">5.1.4.3</span> Uncertainty on logistic curve</h5>
<p>By leveraging simulations on posteriors, we can define credible interval on our logistic regression:</p>
<ul>
<li>For each value of <span class="math inline">\(x\)</span>:
<ul>
<li>Compute probabilities by sampling from the posterior distribution of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span></li>
<li>Compute the related credible interval</li>
</ul></li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:42.017307Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:42.017177Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:42.143901Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:42.143576Z&quot;}" data-execution_count="39">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Simulation parameters</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>RANGE_T <span class="op">=</span> np.linspace(<span class="dv">30</span>, <span class="dv">85</span>, <span class="dv">101</span>)</span>
<span id="cb40-3"><a href="#cb40-3"></a>RANGE_X <span class="op">=</span> RANGE_T <span class="op">-</span> offset</span>
<span id="cb40-4"><a href="#cb40-4"></a></span>
<span id="cb40-5"><a href="#cb40-5"></a>NB_SAMPLE_PER_X <span class="op">=</span> <span class="dv">10_000</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>QUANTS <span class="op">=</span> [<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>]</span>
<span id="cb40-7"><a href="#cb40-7"></a></span>
<span id="cb40-8"><a href="#cb40-8"></a>x_to_probs_thresh <span class="op">=</span> {} <span class="co"># Will contain the q5, q50 and q95 of the distribution of probs for each x</span></span>
<span id="cb40-9"><a href="#cb40-9"></a></span>
<span id="cb40-10"><a href="#cb40-10"></a></span>
<span id="cb40-11"><a href="#cb40-11"></a><span class="co"># For each value of x</span></span>
<span id="cb40-12"><a href="#cb40-12"></a><span class="cf">for</span> x <span class="kw">in</span> RANGE_X:</span>
<span id="cb40-13"><a href="#cb40-13"></a></span>
<span id="cb40-14"><a href="#cb40-14"></a>    <span class="co"># compute n probs by sampling from posteriors</span></span>
<span id="cb40-15"><a href="#cb40-15"></a>    log_odds <span class="op">=</span> posterior_a.choice(NB_SAMPLE_PER_X) <span class="op">*</span> x <span class="op">+</span> posterior_b.choice(NB_SAMPLE_PER_X) </span>
<span id="cb40-16"><a href="#cb40-16"></a>    probs <span class="op">=</span> scipy.special.expit(log_odds)</span>
<span id="cb40-17"><a href="#cb40-17"></a>    x_to_probs_thresh[x] <span class="op">=</span> pd.Series(probs).quantile(QUANTS)</span>
<span id="cb40-18"><a href="#cb40-18"></a></span>
<span id="cb40-19"><a href="#cb40-19"></a><span class="co"># Format the data</span></span>
<span id="cb40-20"><a href="#cb40-20"></a>x_to_probs_thresh <span class="op">=</span> pd.DataFrame(x_to_probs_thresh).T.rename_axis(<span class="st">"x"</span>).reset_index()</span>
<span id="cb40-21"><a href="#cb40-21"></a>x_to_probs_thresh[<span class="st">"temp"</span>] <span class="op">=</span> RANGE_T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:42.145703Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:42.145586Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:42.276927Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:42.276517Z&quot;}" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>plt.fill_between(</span>
<span id="cb41-2"><a href="#cb41-2"></a>    x_to_probs_thresh[<span class="st">"temp"</span>],</span>
<span id="cb41-3"><a href="#cb41-3"></a>    x_to_probs_thresh[<span class="fl">0.05</span>],</span>
<span id="cb41-4"><a href="#cb41-4"></a>    x_to_probs_thresh[<span class="fl">0.95</span>],</span>
<span id="cb41-5"><a href="#cb41-5"></a>    color<span class="op">=</span><span class="st">"cornflowerblue"</span>,</span>
<span id="cb41-6"><a href="#cb41-6"></a>    alpha<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb41-7"><a href="#cb41-7"></a>)</span>
<span id="cb41-8"><a href="#cb41-8"></a></span>
<span id="cb41-9"><a href="#cb41-9"></a>sns.lineplot(data<span class="op">=</span>x_to_probs_thresh, x<span class="op">=</span><span class="st">"temp"</span>, y<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Logistic model"</span>)</span>
<span id="cb41-10"><a href="#cb41-10"></a>sns.scatterplot(</span>
<span id="cb41-11"><a href="#cb41-11"></a>    data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"temp"</span>, y<span class="op">=</span><span class="st">"y"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">"orangered"</span>, label<span class="op">=</span><span class="st">"Observed data"</span></span>
<span id="cb41-12"><a href="#cb41-12"></a>)</span>
<span id="cb41-13"><a href="#cb41-13"></a></span>
<span id="cb41-14"><a href="#cb41-14"></a>plt.gca().<span class="bu">set</span>(</span>
<span id="cb41-15"><a href="#cb41-15"></a>    title<span class="op">=</span><span class="st">"Median P(Y = 1 | T°) with 90</span><span class="sc">% c</span><span class="st">redible interval"</span>,</span>
<span id="cb41-16"><a href="#cb41-16"></a>    xlabel<span class="op">=</span><span class="st">"T°"</span>,</span>
<span id="cb41-17"><a href="#cb41-17"></a>    ylabel<span class="op">=</span><span class="st">"P(Y=1)"</span>,</span>
<span id="cb41-18"><a href="#cb41-18"></a>)</span>
<span id="cb41-19"><a href="#cb41-19"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="linear-regression" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="linear-regression"><span class="header-section-number">5.2</span> Linear regression</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Theory">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory
</div>
</div>
<div class="callout-body-container callout-body">
<p>The assumption of the linear regression is that you can model <span class="math inline">\(y\)</span> in the following way: <span class="math display">\[ y = (\sum_{i=1}^{n} w_i * x_i) + \epsilon \]</span></p>
<p>With: <span class="math display">\[\epsilon \sim \mathcal{N}(0,\,\sigma^{2})  \]</span></p>
</div>
</div>
<p>The aim is to estimate the values of <span class="math inline">\(w_i\)</span> and <span class="math inline">\(\sigma\)</span></p>
<section id="grid-method-7" class="level4" data-number="5.2.1">
<h4 data-number="5.2.1" class="anchored" data-anchor-id="grid-method-7"><span class="header-section-number">5.2.1</span> Grid method</h4>
<div class="callout callout-style-default callout-note no-icon callout-titled" title="Example">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We observe the quantity of snow each year for 54 years, does the snow quantity tends to increase ?<br>
The following notations are used: <span class="math display">\[y = a * x + b + \mathcal{N}(0,\,\sigma^{2})\]</span></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:42.278943Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:42.278810Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:37:42.283511Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:37:42.283185Z&quot;}" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a>year <span class="op">=</span> [<span class="dv">1967</span>, <span class="dv">1968</span>, <span class="dv">1969</span>, <span class="dv">1970</span>, <span class="dv">1971</span>, <span class="dv">1972</span>, <span class="dv">1973</span>, <span class="dv">1974</span>, <span class="dv">1975</span>, <span class="dv">1976</span>, <span class="dv">1977</span>, <span class="dv">1978</span>, <span class="dv">1979</span>, <span class="dv">1980</span>, <span class="dv">1981</span>, <span class="dv">1982</span>, <span class="dv">1983</span>, <span class="dv">1984</span>, <span class="dv">1985</span>, <span class="dv">1986</span>, <span class="dv">1987</span>, <span class="dv">1988</span>, <span class="dv">1989</span>, <span class="dv">1990</span>, <span class="dv">1991</span>, <span class="dv">1992</span>, <span class="dv">1993</span>, <span class="dv">1994</span>, <span class="dv">1995</span>, <span class="dv">1996</span>, <span class="dv">1997</span>, <span class="dv">1998</span>, <span class="dv">1999</span>, <span class="dv">2000</span>, <span class="dv">2001</span>, <span class="dv">2002</span>, <span class="dv">2003</span>, <span class="dv">2004</span>, <span class="dv">2005</span>, <span class="dv">2006</span>, <span class="dv">2007</span>, <span class="dv">2008</span>, <span class="dv">2009</span>, <span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>]</span>
<span id="cb42-2"><a href="#cb42-2"></a>amount_fall <span class="op">=</span> [<span class="fl">28.6</span>, <span class="fl">44.7</span>, <span class="fl">99.2</span>, <span class="fl">66.8</span>, <span class="fl">54.6</span>, <span class="fl">68.7</span>, <span class="fl">12.5</span>, <span class="fl">46.5</span>, <span class="fl">61.9</span>, <span class="fl">57.7</span>, <span class="fl">65.5</span>, <span class="fl">100.6</span>, <span class="fl">34.4</span>, <span class="fl">27.7</span>, <span class="fl">54.2</span>, <span class="fl">64.1</span>, <span class="fl">50.2</span>, <span class="fl">56.3</span>, <span class="fl">49.7</span>, <span class="fl">38.3</span>, <span class="fl">89.3</span>, <span class="fl">53.5</span>, <span class="fl">38.5</span>, <span class="fl">52.5</span>, <span class="fl">30.7</span>, <span class="fl">39.0</span>, <span class="fl">80.1</span>, <span class="fl">88.7</span>, <span class="fl">46.0</span>, <span class="fl">124.2</span>, <span class="fl">77.1</span>, <span class="fl">24.1</span>, <span class="fl">56.6</span>, <span class="fl">43.7</span>, <span class="fl">90.8</span>, <span class="fl">61.5</span>, <span class="fl">112.0</span>, <span class="fl">51.8</span>, <span class="fl">110.7</span>, <span class="fl">40.6</span>, <span class="fl">54.2</span>, <span class="fl">59.1</span>, <span class="fl">85.8</span>, <span class="fl">57.6</span>, <span class="fl">82.3</span>, <span class="fl">31.1</span>, <span class="fl">99.1</span>, <span class="fl">80.6</span>, <span class="fl">141.1</span>, <span class="fl">64.0</span>, <span class="fl">68.0</span>, <span class="fl">90.4</span>, <span class="fl">59.6</span>, <span class="fl">12.2</span>]</span>
<span id="cb42-3"><a href="#cb42-3"></a></span>
<span id="cb42-4"><a href="#cb42-4"></a>df_snow <span class="op">=</span> pd.DataFrame({<span class="st">"year"</span>: year, <span class="st">"amount_fall"</span>: amount_fall})</span>
<span id="cb42-5"><a href="#cb42-5"></a></span>
<span id="cb42-6"><a href="#cb42-6"></a>offset <span class="op">=</span> df_snow.year.mean()</span>
<span id="cb42-7"><a href="#cb42-7"></a>df_snow[<span class="st">"x"</span>] <span class="op">=</span> df_snow.year <span class="op">-</span> offset</span>
<span id="cb42-8"><a href="#cb42-8"></a>df_snow[<span class="st">"y"</span>] <span class="op">=</span> df_snow.amount_fall</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:37:42.284953Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:37:42.284829Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:38:01.353009Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:38:01.352641Z&quot;}" data-execution_count="42">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># Priors</span></span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a>range_a <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="dv">51</span>)</span>
<span id="cb43-4"><a href="#cb43-4"></a>range_b <span class="op">=</span> np.linspace(<span class="dv">54</span>, <span class="dv">75</span>, <span class="dv">21</span>)</span>
<span id="cb43-5"><a href="#cb43-5"></a>range_sigma <span class="op">=</span> np.linspace(<span class="dv">20</span>, <span class="dv">35</span>, <span class="dv">31</span>)  <span class="co"># epsilon sigma</span></span>
<span id="cb43-6"><a href="#cb43-6"></a></span>
<span id="cb43-7"><a href="#cb43-7"></a>cols <span class="op">=</span> [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"sigma"</span>]</span>
<span id="cb43-8"><a href="#cb43-8"></a></span>
<span id="cb43-9"><a href="#cb43-9"></a>prior <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(product(range_a, range_b, range_sigma)), columns<span class="op">=</span>cols)</span>
<span id="cb43-10"><a href="#cb43-10"></a>prior[<span class="st">"p"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(prior)</span>
<span id="cb43-11"><a href="#cb43-11"></a></span>
<span id="cb43-12"><a href="#cb43-12"></a>prior <span class="op">=</span> Pmf(prior.set_index(cols).p)</span>
<span id="cb43-13"><a href="#cb43-13"></a></span>
<span id="cb43-14"><a href="#cb43-14"></a></span>
<span id="cb43-15"><a href="#cb43-15"></a><span class="co"># Likelihood</span></span>
<span id="cb43-16"><a href="#cb43-16"></a></span>
<span id="cb43-17"><a href="#cb43-17"></a>likelihood <span class="op">=</span> prior.copy()</span>
<span id="cb43-18"><a href="#cb43-18"></a></span>
<span id="cb43-19"><a href="#cb43-19"></a><span class="cf">for</span> a, b, sigma <span class="kw">in</span> prior.index:</span>
<span id="cb43-20"><a href="#cb43-20"></a></span>
<span id="cb43-21"><a href="#cb43-21"></a>    <span class="co">#likelihood = scipy.stats.multinomial.pmf(obs, nb_e, probs)</span></span>
<span id="cb43-22"><a href="#cb43-22"></a>    </span>
<span id="cb43-23"><a href="#cb43-23"></a>    y_est <span class="op">=</span> a <span class="op">*</span> df_snow.x <span class="op">+</span> b</span>
<span id="cb43-24"><a href="#cb43-24"></a>    residuals <span class="op">=</span> df_snow.y <span class="op">-</span> y_est</span>
<span id="cb43-25"><a href="#cb43-25"></a>    likelihoods <span class="op">=</span> scipy.stats.norm(<span class="dv">0</span>, sigma).pdf(residuals)</span>
<span id="cb43-26"><a href="#cb43-26"></a></span>
<span id="cb43-27"><a href="#cb43-27"></a>    likelihood[a, b, sigma] <span class="op">=</span> likelihoods.prod()</span>
<span id="cb43-28"><a href="#cb43-28"></a></span>
<span id="cb43-29"><a href="#cb43-29"></a></span>
<span id="cb43-30"><a href="#cb43-30"></a><span class="co"># Bayes formula</span></span>
<span id="cb43-31"><a href="#cb43-31"></a></span>
<span id="cb43-32"><a href="#cb43-32"></a>posterior <span class="op">=</span> prior <span class="op">*</span> likelihood</span>
<span id="cb43-33"><a href="#cb43-33"></a>posterior.normalize()</span>
<span id="cb43-34"><a href="#cb43-34"></a></span>
<span id="cb43-35"><a href="#cb43-35"></a></span>
<span id="cb43-36"><a href="#cb43-36"></a><span class="co"># Marginal</span></span>
<span id="cb43-37"><a href="#cb43-37"></a></span>
<span id="cb43-38"><a href="#cb43-38"></a>marginal_a <span class="op">=</span> Pmf(posterior.rename(<span class="st">"p"</span>).reset_index().groupby(<span class="st">"a"</span>).p.<span class="bu">sum</span>())</span>
<span id="cb43-39"><a href="#cb43-39"></a>marginal_b <span class="op">=</span> Pmf(posterior.rename(<span class="st">"p"</span>).reset_index().groupby(<span class="st">"b"</span>).p.<span class="bu">sum</span>())</span>
<span id="cb43-40"><a href="#cb43-40"></a>marginal_sigma <span class="op">=</span> Pmf(posterior.rename(<span class="st">"p"</span>).reset_index().groupby(<span class="st">"sigma"</span>).p.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mcmc---pymc-1" class="level4" data-number="5.2.2">
<h4 data-number="5.2.2" class="anchored" data-anchor-id="mcmc---pymc-1"><span class="header-section-number">5.2.2</span> MCMC - PyMC</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:38:01.355716Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:38:01.355365Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:38:06.237119Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:38:06.236741Z&quot;}" data-execution_count="43">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> model:</span>
<span id="cb44-2"><a href="#cb44-2"></a>    a <span class="op">=</span> pm.Uniform(<span class="st">"a"</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb44-3"><a href="#cb44-3"></a>    b <span class="op">=</span> pm.Uniform(<span class="st">"b"</span>, <span class="dv">54</span>, <span class="dv">75</span>)</span>
<span id="cb44-4"><a href="#cb44-4"></a>    sigma <span class="op">=</span> pm.Uniform(<span class="st">"sigma"</span>, <span class="dv">20</span>, <span class="dv">35</span>)</span>
<span id="cb44-5"><a href="#cb44-5"></a></span>
<span id="cb44-6"><a href="#cb44-6"></a>    est_y <span class="op">=</span> a <span class="op">*</span> df_snow.x <span class="op">+</span> b</span>
<span id="cb44-7"><a href="#cb44-7"></a>    y <span class="op">=</span> pm.Normal(<span class="st">"y"</span>, mu<span class="op">=</span>y_est, sigma<span class="op">=</span>sigma, observed<span class="op">=</span>df_snow.y)</span>
<span id="cb44-8"><a href="#cb44-8"></a>    trace_binom <span class="op">=</span> pm.sample(<span class="dv">1000</span>, return_inferencedata<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a>a_posterior_samples <span class="op">=</span> trace_binom.get_values(<span class="st">"a"</span>)</span>
<span id="cb44-11"><a href="#cb44-11"></a>b_posterior_samples <span class="op">=</span> trace_binom.get_values(<span class="st">"b"</span>)</span>
<span id="cb44-12"><a href="#cb44-12"></a>sigma_posterior_samples <span class="op">=</span> trace_binom.get_values(<span class="st">"sigma"</span>)</span>
<span id="cb44-13"><a href="#cb44-13"></a></span>
<span id="cb44-14"><a href="#cb44-14"></a>posterior_samples <span class="op">=</span> pd.DataFrame(</span>
<span id="cb44-15"><a href="#cb44-15"></a>    {</span>
<span id="cb44-16"><a href="#cb44-16"></a>        <span class="st">"a"</span>: a_posterior_samples,</span>
<span id="cb44-17"><a href="#cb44-17"></a>        <span class="st">"b"</span>: b_posterior_samples,</span>
<span id="cb44-18"><a href="#cb44-18"></a>        <span class="st">"sigma"</span>: sigma_posterior_samples,</span>
<span id="cb44-19"><a href="#cb44-19"></a>    }</span>
<span id="cb44-20"><a href="#cb44-20"></a>)</span>
<span id="cb44-21"><a href="#cb44-21"></a>posterior_samples.mean().<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mcmc---bambi-1" class="level4" data-number="5.2.3">
<h4 data-number="5.2.3" class="anchored" data-anchor-id="mcmc---bambi-1"><span class="header-section-number">5.2.3</span> MCMC - Bambi</h4>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:38:06.238973Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:38:06.238833Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:38:10.688103Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:38:10.687702Z&quot;}" data-execution_count="44">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a>model <span class="op">=</span> bmb.Model(<span class="st">"y ~ x"</span>, df_snow)</span>
<span id="cb45-2"><a href="#cb45-2"></a>fitted <span class="op">=</span> model.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:38:10.691196Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:38:10.690961Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:38:10.712592Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:38:10.712209Z&quot;}" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a>az.summary(fitted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
<th data-quarto-table-cell-role="th">mcse_mean</th>
<th data-quarto-table-cell-role="th">mcse_sd</th>
<th data-quarto-table-cell-role="th">ess_bulk</th>
<th data-quarto-table-cell-role="th">ess_tail</th>
<th data-quarto-table-cell-role="th">r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Intercept</td>
<td>62.505</td>
<td>3.848</td>
<td>55.385</td>
<td>69.771</td>
<td>0.053</td>
<td>0.038</td>
<td>5371.0</td>
<td>3087.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x</td>
<td>0.421</td>
<td>0.244</td>
<td>-0.030</td>
<td>0.876</td>
<td>0.003</td>
<td>0.003</td>
<td>5554.0</td>
<td>3011.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">y_sigma</td>
<td>27.242</td>
<td>2.763</td>
<td>22.135</td>
<td>32.386</td>
<td>0.038</td>
<td>0.028</td>
<td>5427.0</td>
<td>3126.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="uncertainty-on-regression-curve" class="level4" data-number="5.2.4">
<h4 data-number="5.2.4" class="anchored" data-anchor-id="uncertainty-on-regression-curve"><span class="header-section-number">5.2.4</span> Uncertainty on regression curve</h4>
<p>By leveraging simulations on posteriors, we can define credible interval on our linear regression:</p>
<ul>
<li>For each value of <span class="math inline">\(x\)</span>:
<ul>
<li>Compute probabilities by sampling from the posterior distribution of <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and <span class="math inline">\(\sigma\)</span></li>
<li>Compute the related credible interval</li>
</ul></li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:38:10.714629Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:38:10.714503Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:38:10.923215Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:38:10.922875Z&quot;}" data-execution_count="46">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Simulation parameters</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>RANGE_YEAR <span class="op">=</span> np.linspace(df_snow.year.<span class="bu">min</span>(), df_snow.year.<span class="bu">max</span>(), <span class="dv">101</span>)</span>
<span id="cb47-3"><a href="#cb47-3"></a>RANGE_X <span class="op">=</span> RANGE_YEAR <span class="op">-</span> offset</span>
<span id="cb47-4"><a href="#cb47-4"></a></span>
<span id="cb47-5"><a href="#cb47-5"></a>NB_SAMPLE_PER_X <span class="op">=</span> <span class="dv">10_000</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>QUANTS <span class="op">=</span> [<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>]</span>
<span id="cb47-7"><a href="#cb47-7"></a></span>
<span id="cb47-8"><a href="#cb47-8"></a>x_to_y_thresh <span class="op">=</span> {} <span class="co"># Will contain the q5, q50 and q95 of the distribution of probs for each x</span></span>
<span id="cb47-9"><a href="#cb47-9"></a></span>
<span id="cb47-10"><a href="#cb47-10"></a><span class="co"># For each value of x</span></span>
<span id="cb47-11"><a href="#cb47-11"></a><span class="cf">for</span> x <span class="kw">in</span> RANGE_X:</span>
<span id="cb47-12"><a href="#cb47-12"></a>    </span>
<span id="cb47-13"><a href="#cb47-13"></a>    samples_a <span class="op">=</span> marginal_a.choice(NB_SAMPLE_PER_X) </span>
<span id="cb47-14"><a href="#cb47-14"></a>    samples_b <span class="op">=</span> marginal_b.choice(NB_SAMPLE_PER_X)</span>
<span id="cb47-15"><a href="#cb47-15"></a>    samples_sigma <span class="op">=</span> marginal_sigma.choice(NB_SAMPLE_PER_X)</span>
<span id="cb47-16"><a href="#cb47-16"></a></span>
<span id="cb47-17"><a href="#cb47-17"></a>    <span class="co"># compute n probs by sampling from posteriors</span></span>
<span id="cb47-18"><a href="#cb47-18"></a>    ys <span class="op">=</span> samples_a <span class="op">*</span> x <span class="op">+</span> samples_b <span class="op">+</span> scipy.stats.norm(<span class="dv">0</span>, samples_sigma).rvs(NB_SAMPLE_PER_X) </span>
<span id="cb47-19"><a href="#cb47-19"></a>    x_to_y_thresh[x] <span class="op">=</span> pd.Series(ys).quantile(QUANTS)</span>
<span id="cb47-20"><a href="#cb47-20"></a></span>
<span id="cb47-21"><a href="#cb47-21"></a><span class="co"># Format the data</span></span>
<span id="cb47-22"><a href="#cb47-22"></a>x_to_y_thresh <span class="op">=</span> pd.DataFrame(x_to_y_thresh).T.rename_axis(<span class="st">"x"</span>).reset_index()</span>
<span id="cb47-23"><a href="#cb47-23"></a>x_to_y_thresh[<span class="st">"year"</span>] <span class="op">=</span> RANGE_YEAR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-25T06:38:10.925155Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-25T06:38:10.925031Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-25T06:38:11.092653Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-25T06:38:11.092269Z&quot;}" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>plt.fill_between(</span>
<span id="cb48-2"><a href="#cb48-2"></a>    x_to_y_thresh[<span class="st">"year"</span>],</span>
<span id="cb48-3"><a href="#cb48-3"></a>    x_to_y_thresh[<span class="fl">0.05</span>],</span>
<span id="cb48-4"><a href="#cb48-4"></a>    x_to_y_thresh[<span class="fl">0.95</span>],</span>
<span id="cb48-5"><a href="#cb48-5"></a>    color<span class="op">=</span><span class="st">"cornflowerblue"</span>,</span>
<span id="cb48-6"><a href="#cb48-6"></a>    alpha<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb48-7"><a href="#cb48-7"></a>)</span>
<span id="cb48-8"><a href="#cb48-8"></a></span>
<span id="cb48-9"><a href="#cb48-9"></a>sns.lineplot(data<span class="op">=</span>x_to_y_thresh, x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"Linear model"</span>)</span>
<span id="cb48-10"><a href="#cb48-10"></a>sns.scatterplot(</span>
<span id="cb48-11"><a href="#cb48-11"></a>    data<span class="op">=</span>df_snow, x<span class="op">=</span><span class="st">"year"</span>, y<span class="op">=</span><span class="st">"y"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">"orangered"</span>, label<span class="op">=</span><span class="st">"Observed data"</span></span>
<span id="cb48-12"><a href="#cb48-12"></a>)</span>
<span id="cb48-13"><a href="#cb48-13"></a></span>
<span id="cb48-14"><a href="#cb48-14"></a>plt.gca().<span class="bu">set</span>(</span>
<span id="cb48-15"><a href="#cb48-15"></a>    title<span class="op">=</span><span class="st">"Median Snowfall with 90</span><span class="sc">% c</span><span class="st">redible interval"</span>,</span>
<span id="cb48-16"><a href="#cb48-16"></a>    xlabel<span class="op">=</span><span class="st">"Year"</span>,</span>
<span id="cb48-17"><a href="#cb48-17"></a>    ylabel<span class="op">=</span><span class="st">"Snowfall (cm)"</span>,</span>
<span id="cb48-18"><a href="#cb48-18"></a>)</span>
<span id="cb48-19"><a href="#cb48-19"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="think_bayes_notes_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>